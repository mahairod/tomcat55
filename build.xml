<project name="Tomcat 6.0" default="deploy" basedir=".">


  <!-- ===================== Initialize Property Values =================== -->

  <!-- See "build.properties.sample" in the top level directory for all     -->
  <!-- property values you must customize for successful building!!!        -->
  <property file="${user.home}/build.properties"/>
  <property file="build.properties"/>

  <property file="build.properties.default"/>

  <!-- Project Properties -->
  <property name="name"                  value="Apache Tomcat" />
  <property name="year"                  value="2005" />
  <property name="version.major"         value="6" />
  <property name="version.minor"         value="0" />
  <property name="version.build"         value="0" />
  <property name="version.patch"         value="0" />
  <property name="version"               value="6.0.0-dev" />
  <property name="version.number"        value="${version.major}.${version.minor}.${version.build}.${version.patch}" />

  <property name="project"               value="apache-tomcat" />
  <property name="final.name"            value="${project}-${version}" />
  <property name="final-src.name"        value="${project}-${version}-src" />

  <!-- Build Defaults -->
  <property name="tomcat.build"      value="${basedir}/build"/>
  <property name="tomcat.classes"    value="${basedir}/classes"/>
  <property name="tomcat.dist"       value="${basedir}/dist"/>
  <property name="test.failonerror"  value="true"/>
  <property name="test.runner"       value="junit.textui.TestRunner"/>

  <!-- Can't be lower - jsp uses templates -->
  <property name="compile.source" value="1.5"/>
  
  <!-- Defaults, if build.properties is missing. It is sometimes easier to 
       just have one build file, and use properties to just override settings -->
  <property name="TOMCAT_LIBS_BASE" location="../repository"/>
  
  <property name="ant.jar" location="${TOMCAT_LIBS_BASE}/apache-ant-1.6.5/lib/ant.jar"/>
  <property name="jdt.jar" location="${TOMCAT_LIBS_BASE}/eclipse/plugins/org.eclipse.jdt.core_3.1.1.jar"/>
  <property name="commons-logging.jar" location="${TOMCAT_LIBS_BASE}/commons-logging-1.0.4/commons-logging.jar"/>
  <property name="commons-modeler.jar" location="${TOMCAT_LIBS_BASE}/commons-modeler-1.1/commons-modeler.jar"/>
      
  
  <!-- JAR artifacts -->
  <property name="servlet-api.jar" value="${tomcat.build}/common/lib/servlet-api.jar"/>
  <property name="jsp-api.jar" value="${tomcat.build}/common/lib/jsp-api.jar"/>
  <property name="el-api.jar" value="${tomcat.build}/common/lib/el-api.jar"/>
  <property name="jasper-compiler.jar" value="${tomcat.build}/common/lib/jasper-compiler.jar"/>
  <property name="jasper-runtime.jar" value="${tomcat.build}/common/lib/jasper-runtime.jar"/>
  <property name="jasper-el.jar" value="${tomcat.build}/common/lib/jasper-el.jar"/>
  
  <!-- Classpath -->
  <path id="tomcat.classpath">
    <pathelement location="${ant.jar}"/>
    <pathelement location="${jdt.jar}"/>
    <pathelement location="${commons-logging.jar}"/>
    <pathelement location="${commons-modeler.jar}"/>
  </path>

  <!-- Just build Tomcat -->
  <target name="build-prepare">

    <available classname="junit.framework.TestCase" property="junit.present" />

    <mkdir dir="${tomcat.classes}"/>
    
    <mkdir dir="${tomcat.build}"/>
    <mkdir dir="${tomcat.build}/bin"/>
    <mkdir dir="${tomcat.build}/conf"/>
    <mkdir dir="${tomcat.build}/lib"/>

  </target>

  <target name="compile">

    <!-- Compile internal server components -->
    <javac srcdir="java" destdir="${tomcat.classes}"
           debug="${compile.debug}"
           deprecation="${compile.deprecation}"
           source="${compile.source}"
           optimize="${compile.optimize}"
           excludes="**/CVS/**,**/.svn/**">
      <classpath refid="tomcat.classpath" />
      <exclude name="org/apache/tomcat/util/net/puretls/**" />
      <exclude name="org/apache/naming/factory/MailSessionFactory.java"/>
      <exclude name="org/apache/naming/factory/SendMailFactory.java"/>
    </javac>
    <!-- Copy static resource files -->
    <copy todir="${tomcat.classes}">
      <fileset dir="java">
        <include name="**/*.properties"/>
        <include name="**/*.dtd"/>
      </fileset>
    </copy>

  </target>
    
  <target name="build-only" depends="build-prepare,compile,package" />
  
  <target name="package" >  
    <!-- Servlet 2.5 Implementation JAR File -->
    <jar  jarfile="${servlet-api.jar}">
      <fileset dir="${tomcat.classes}">
        <include name="javax/servlet/*" />
        <include name="javax/servlet/http/*" />
        <include name="javax/servlet/resources/*" />
        <!-- Javadoc and i18n exclusions -->
        <exclude name="**/package.html" />
        <exclude name="**/LocalStrings_*" />
      </fileset>
    </jar>

    <!-- JSP 2.1 Implementation JAR File -->
    <jar  jarfile="${jsp-api.jar}">
      <fileset dir="${tomcat.classes}">
        <include name="javax/servlet/jsp/**" />
        <!-- Javadoc and i18n exclusions -->
        <exclude name="**/package.html" />
        <exclude name="**/LocalStrings_*" />
      </fileset>
    </jar>

    <!-- JSP 2.1 EL Implementation JAR File -->
    <jar  jarfile="${el-api.jar}">
      <fileset dir="${tomcat.classes}">
        <include name="javax/el/**" />
        <!-- Javadoc and i18n exclusions -->
        <exclude name="**/package.html" />
        <exclude name="**/LocalStrings_*" />
      </fileset>
    </jar>

    <!-- Jasper Compiler JAR File -->
    <jar  jarfile="${jasper-compiler.jar}">
       <fileset dir="${tomcat.classes}">
         <include name="org/apache/jasper/compiler/**" />
         <include name="org/apache/jasper/xmlparser/**" />
         <include name="org/apache/jasper/servlet/**" />
         <include name="org/apache/jasper/tagplugins/**" />
         <exclude name="org/apache/jasper/Constants.class" />
         <exclude name="org/apache/jasper/JasperException.class" />
         <include name="org/apache/jasper/*.class" />
         <!-- Javadoc and i18n exclusions -->
         <exclude name="**/package.html" />
         <exclude name="**/LocalStrings_*" />
       </fileset>
     </jar>

     <!-- Jasper Runtime JAR File -->
     <jar  jarfile="${jasper-runtime.jar}">
       <fileset dir="${tomcat.classes}">
         <include name="org/apache/jasper/Constants.class" />
         <include name="org/apache/jasper/JasperException.class" />
         <include name="org/apache/jasper/compiler/Localizer.class" />
         <include name="org/apache/jasper/el/**" />
         <include name="org/apache/jasper/resources/**" />
         <include name="org/apache/jasper/runtime/**" />
         <include name="org/apache/jasper/security/**" />
         <include name="org/apache/jasper/util/**" />
         <!-- Javadoc and i18n exclusions -->
         <exclude name="**/package.html" />
         <exclude name="**/LocalStrings_*" />
       </fileset>
     </jar>

     <!-- Jasper EL Implementation JAR File -->
     <jar  jarfile="${jasper-el.jar}">
       <fileset dir="${tomcat.classes}">
         <include name="org/apache/el/**" />
         <!-- Javadoc and i18n exclusions -->
         <exclude name="**/package.html" />
         <exclude name="**/LocalStrings_*" />
       </fileset>
     </jar>

  </target>

  <target name="deploy" depends="build-only">
  </target>

</project>
