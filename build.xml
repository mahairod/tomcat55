<project name="Tomcat 6.0" default="deploy" basedir=".">


  <!-- ===================== Initialize Property Values =================== -->

  <!-- See "build.properties.sample" in the top level directory for all     -->
  <!-- property values you must customize for successful building!!!        -->
  <property file="${user.home}/build.properties"/>
  <property file="build.properties"/>

  <property file="build.properties.default"/>

  <!-- Project Properties -->
  <property name="name"                  value="Apache Tomcat" />
  <property name="year"                  value="2005" />
  <property name="version.major"         value="6" />
  <property name="version.minor"         value="0" />
  <property name="version.build"         value="0" />
  <property name="version.patch"         value="0" />
  <property name="version"               value="6.0.0-dev" />
  <property name="version.number"        value="${version.major}.${version.minor}.${version.build}.${version.patch}" />

  <property name="project"               value="apache-tomcat" />
  <property name="final.name"            value="${project}-${version}" />
  <property name="final-src.name"        value="${project}-${version}-src" />

  <!-- Build Defaults -->
  <property name="tomcat.build"      value="${basedir}/build"/>
  <property name="tomcat.classes"    value="${basedir}/classes"/>
  <property name="tomcat.dist"       value="${basedir}/dist"/>
  <property name="test.failonerror"  value="true"/>
  <property name="test.runner"       value="junit.textui.TestRunner"/>

  <!-- Can't be lower - jsp uses templates -->
  <property name="compile.source" value="1.5"/>
  
  <!-- JAR artifacts -->
  <property name="servlet-api.jar" value="${tomcat.build}/lib/servlet-api.jar"/>
  <property name="jsp-api.jar" value="${tomcat.build}/lib/jsp-api.jar"/>
  <property name="el-api.jar" value="${tomcat.build}/lib/el-api.jar"/>
  <property name="catalina.jar" value="${tomcat.build}/lib/catalina.jar"/>
  <property name="catalina-ant.jar" value="${tomcat.build}/lib/catalina-ant.jar"/>
  <property name="catalina-ant-jmx.jar" value="${tomcat.build}/lib/catalina-ant-jmx.jar"/>
  <property name="naming-factory.jar" value="${tomcat.build}/lib/naming-factory.jar"/>
  <property name="naming-resources.jar" value="${tomcat.build}/lib/naming-resources.jar"/>
  <property name="servlets-cgi.jar" value="${tomcat.build}/lib/servlets-cgi.renametojar"/>
  <property name="servlets-default.jar" value="${tomcat.build}/lib/servlets-default.jar"/>
  <property name="servlets-invoker.jar" value="${tomcat.build}/lib/servlets-invoker.jar"/>
  <property name="servlets-ssi.jar" value="${tomcat.build}/lib/servlets-ssi.renametojar"/>
  <property name="servlets-webdav.jar" value="${tomcat.build}/lib/servlets-webdav.jar"/>
  <property name="tomcat-util.jar" value="${tomcat.build}/lib/tomcat-util.jar"/>
  <property name="tomcat-coyote.jar" value="${tomcat.build}/lib/tomcat-coyote.jar"/>
  <property name="tomcat-apr.jar" value="${tomcat.build}/lib/tomcat-apr.jar"/>
  <property name="tomcat-ajp.jar" value="${tomcat.build}/lib/tomcat-ajp.jar"/>
  <property name="tomcat-http.jar" value="${tomcat.build}/lib/tomcat-http.jar"/>

  <property name="jasper-compiler.jar" value="${tomcat.build}/lib/jasper-compiler.jar"/>
  <property name="jasper-runtime.jar" value="${tomcat.build}/lib/jasper-runtime.jar"/>
  <property name="jasper-el.jar" value="${tomcat.build}/lib/jasper-el.jar"/>
  
  <!-- Classpath -->
  <path id="tomcat.classpath">
    <pathelement location="${ant.jar}"/>
    <pathelement location="${jdt.jar}"/>
    <pathelement location="${commons-logging.jar}"/>
    <pathelement location="${commons-modeler.jar}"/>
  </path>

  <!-- Just build Tomcat -->
  <target name="build-prepare">

    <available classname="junit.framework.TestCase" property="junit.present" />

    <mkdir dir="${tomcat.classes}"/>
    
    <mkdir dir="${tomcat.build}"/>
    <mkdir dir="${tomcat.build}/bin"/>
    <mkdir dir="${tomcat.build}/conf"/>
    <mkdir dir="${tomcat.build}/lib"/>

  </target>

  <target name="compile">

    <!-- Compile internal server components -->
    <javac srcdir="java" destdir="${tomcat.classes}"
           debug="${compile.debug}"
           deprecation="${compile.deprecation}"
           source="${compile.source}"
           optimize="${compile.optimize}"
           excludes="**/CVS/**,**/.svn/**">
      <classpath refid="tomcat.classpath" />
      <exclude name="org/apache/tomcat/util/net/puretls/**" />
      <exclude name="org/apache/naming/factory/MailSessionFactory.java"/>
      <exclude name="org/apache/naming/factory/SendMailFactory.java"/>
    </javac>
    <!-- Copy static resource files -->
    <copy todir="${tomcat.classes}">
      <fileset dir="java">
        <include name="**/*.properties"/>
        <include name="**/*.dtd"/>
      </fileset>
    </copy>

  </target>

  <target name="build-only" depends="build-prepare,compile,package" />

  <target name="package" >  

    <!-- Servlet 2.5 Implementation JAR File -->
    <jar  jarfile="${servlet-api.jar}" index="true">
      <fileset dir="${tomcat.classes}">
        <include name="javax/servlet/*" />
        <include name="javax/servlet/http/*" />
        <include name="javax/servlet/resources/*" />
        <!-- Javadoc and i18n exclusions -->
        <exclude name="**/package.html" />
        <exclude name="**/LocalStrings_*" />
      </fileset>
    </jar>

    <!-- JSP 2.1 Implementation JAR File -->
    <jar  jarfile="${jsp-api.jar}" index="true">
      <fileset dir="${tomcat.classes}">
        <include name="javax/servlet/jsp/**" />
        <!-- Javadoc and i18n exclusions -->
        <exclude name="**/package.html" />
        <exclude name="**/LocalStrings_*" />
      </fileset>
    </jar>

    <!-- JSP 2.1 EL Implementation JAR File -->
    <jar  jarfile="${el-api.jar}" index="true">
      <fileset dir="${tomcat.classes}">
        <include name="javax/el/**" />
        <!-- Javadoc and i18n exclusions -->
        <exclude name="**/package.html" />
        <exclude name="**/LocalStrings_*" />
      </fileset>
    </jar>

    <!-- Catalina Main JAR File -->
    <jar jarfile="${catalina.jar}" index="true" manifest="res/bootstrap.jar.manifest">
      <fileset dir="${tomcat.classes}">
        <include name="org/apache/catalina/**" />
        <!-- Javadoc and i18n exclusions -->
        <exclude name="**/package.html" />
        <exclude name="**/LocalStrings_*" />
        <!-- Modules -->
        <exclude name="org/apache/catalina/ant/**" />
        <exclude name="org/apache/catalina/cluster/**" />
        <exclude name="org/apache/catalina/launcher/**" />
        <exclude name="org/apache/catalina/servlets/**" />
        <exclude name="org/apache/catalina/storeconfig/**" />
        <exclude name="org/apache/catalina/ssi/**" />
      </fileset>
    </jar>

    <!-- Catalina Ant Tasks JAR File -->
    <jar jarfile="${catalina-ant.jar}" index="true">
      <fileset dir="${tomcat.classes}">
      	<include name="org/apache/catalina/ant/*" />
        <include name="org/apache/catalina/util/Base64.class" />
      	<!-- Javadoc and i18n exclusions -->
        <exclude name="**/package.html" />
        <exclude name="**/LocalStrings_*" />
      </fileset>
    </jar>

  	<!-- Catalina JMX Accessor Ant Tasks JAR File -->
    <jar jarfile="${catalina-ant-jmx.jar}" index="true">
      <fileset dir="${tomcat.classes}">
      	<include name="org/apache/catalina/ant/jmx/*" />
      	<!-- Javadoc and i18n exclusions -->
        <exclude name="**/package.html" />
        <exclude name="**/LocalStrings_*" />
      </fileset>
    </jar>

  	<!-- Naming - Factory JAR File -->
    <jar jarfile="${naming-factory.jar}" index="true">
      <fileset dir="${tomcat.classes}">
        <include name="org/apache/naming/**" />
        <exclude name="org/apache/naming/resources/**" />
        <exclude name="org/apache/naming/JndiPermission.class" />
      	<exclude name="org/apache/naming/NameParserImpl.class" />
      	<exclude name="org/apache/naming/NamingContextBindingsEnumeration.class" />
      	<exclude name="org/apache/naming/NamingContextEnumeration.class" />
      	<exclude name="org/apache/naming/NamingEntry.class" />
      	<exclude name="org/apache/naming/StringManager.class" />
        <!-- Javadoc and i18n exclusions -->
        <exclude name="**/package.html" />
        <exclude name="**/LocalStrings_*" />
      </fileset>
    </jar>

    <!-- Naming - Resources JAR File -->
    <jar jarfile="${naming-resources.jar}" index="true">
      <fileset dir="${tomcat.classes}">
        <include name="org/apache/naming/JndiPermission.class" />
      	<include name="org/apache/naming/NameParserImpl.class" />
      	<include name="org/apache/naming/NamingContextBindingsEnumeration.class" />
      	<include name="org/apache/naming/NamingContextEnumeration.class" />
      	<include name="org/apache/naming/NamingEntry.class" />
      	<include name="org/apache/naming/StringManager.class" />
        <include name="org/apache/naming/resources/**" />
        <!-- Javadoc and i18n exclusions -->
        <exclude name="**/package.html" />
        <exclude name="**/LocalStrings_*" />
      </fileset>
    </jar>

    <!-- Servlets - CGI Servlet -->
    <jar jarfile="${servlets-cgi.jar}" index="true">
      <fileset dir="${tomcat.classes}">
        <include name="org/apache/catalina/servlets/CGI*" />
        <!-- Javadoc and i18n exclusions -->
        <exclude name="**/package.html" />
        <exclude name="**/LocalStrings_*" />
      </fileset>
    </jar>

    <!-- Servlets - Default File-Serving Servlet -->
    <jar jarfile="${servlets-default.jar}" index="true">
      <fileset dir="${tomcat.classes}">
        <include name="org/apache/catalina/servlets/Default*" />
        <include name="org/apache/catalina/servlets/Constants.class" />
        <include name="org/apache/catalina/servlets/LocalStrings.properties" />
        <!-- Javadoc and i18n exclusions -->
        <exclude name="**/package.html" />
        <exclude name="**/LocalStrings_*" />
      </fileset>
    </jar>

    <!-- Servlets - Invoker Servlet -->
    <jar jarfile="${servlets-invoker.jar}" index="true">
      <fileset dir="${tomcat.classes}">
        <include name="org/apache/catalina/servlets/Invoker*" />
        <!-- Javadoc and i18n exclusions -->
        <exclude name="**/package.html" />
        <exclude name="**/LocalStrings_*" />
      </fileset>
    </jar>

    <!-- Servlets - SSI Servlet -->
    <jar jarfile="${servlets-ssi.jar}" index="true">
      <fileset dir="${tomcat.classes}">
        <include name="org/apache/catalina/ssi/**" />
        <!-- Javadoc and i18n exclusions -->
        <exclude name="**/package.html" />
        <exclude name="**/LocalStrings_*" />
      </fileset>
    </jar>

    <!-- Servlets - Webdav Servlet -->
    <jar jarfile="${servlets-webdav.jar}" index="true">
      <fileset dir="${tomcat.classes}">
        <include name="org/apache/catalina/servlets/Webdav*" />
        <!-- Javadoc and i18n exclusions -->
        <exclude name="**/package.html" />
        <exclude name="**/LocalStrings_*" />
      </fileset>
    </jar>

    <!-- Protocol handlers - Coyote -->
    <jar jarfile="${tomcat-coyote.jar}" index="true">
      <fileset dir="${tomcat.classes}">
        <include name="org/apache/coyote/*" />
        <include name="org/apache/coyote/memory/*" />
        <!-- Javadoc and i18n exclusions -->
        <exclude name="**/package.html" />
        <exclude name="**/LocalStrings_*" />
      </fileset>
    </jar>

    <!-- Protocol handlers - APR -->
    <jar jarfile="${tomcat-apr.jar}" index="true">
      <fileset dir="${tomcat.classes}">
        <include name="org/apache/tomcat/jni/**" />
        <!-- Javadoc and i18n exclusions -->
        <exclude name="**/package.html" />
        <exclude name="**/LocalStrings_*" />
      </fileset>
    </jar>

    <!-- Protocol handlers - HTTP -->
    <jar jarfile="${tomcat-http.jar}" index="true">
      <fileset dir="${tomcat.classes}">
        <include name="org/apache/coyote/http11/**" />
        <!-- Javadoc and i18n exclusions -->
        <exclude name="**/package.html" />
        <exclude name="**/LocalStrings_*" />
      </fileset>
    </jar>

    <!-- Protocol handlers - AJP -->
    <jar jarfile="${tomcat-ajp.jar}" index="true">
      <fileset dir="${tomcat.classes}">
        <include name="org/apache/coyote/ajp/**" />
        <include name="org/apache/jk/**" />
        <exclude name="org/apache/jk/ant/**" />
        <!-- Javadoc and i18n exclusions -->
        <exclude name="**/package.html" />
        <exclude name="**/LocalStrings_*" />
      </fileset>
    </jar>

    <!-- Util JAR File -->
    <jar jarfile="${tomcat-util.jar}" index="true">
      <fileset dir="${tomcat.classes}">
        <include name="org/apache/tomcat/util/**" />
        <!-- Javadoc and i18n exclusions -->
        <exclude name="**/package.html" />
        <exclude name="**/LocalStrings_*" />
      </fileset>
    </jar>

    <!-- Jasper Compiler JAR File -->
    <jar  jarfile="${jasper-compiler.jar}" index="true">
       <fileset dir="${tomcat.classes}">
         <include name="org/apache/jasper/compiler/**" />
         <include name="org/apache/jasper/xmlparser/**" />
         <include name="org/apache/jasper/servlet/**" />
         <include name="org/apache/jasper/tagplugins/**" />
         <exclude name="org/apache/jasper/Constants.class" />
         <exclude name="org/apache/jasper/JasperException.class" />
         <include name="org/apache/jasper/*.class" />
         <!-- Javadoc and i18n exclusions -->
         <exclude name="**/package.html" />
         <exclude name="**/LocalStrings_*" />
       </fileset>
     </jar>

     <!-- Jasper Runtime JAR File -->
     <jar  jarfile="${jasper-runtime.jar}" index="true">
       <fileset dir="${tomcat.classes}">
         <include name="org/apache/jasper/Constants.class" />
         <include name="org/apache/jasper/JasperException.class" />
         <include name="org/apache/jasper/compiler/Localizer.class" />
         <include name="org/apache/jasper/el/**" />
         <include name="org/apache/jasper/resources/**" />
         <include name="org/apache/jasper/runtime/**" />
         <include name="org/apache/jasper/security/**" />
         <include name="org/apache/jasper/util/**" />
         <!-- Javadoc and i18n exclusions -->
         <exclude name="**/package.html" />
         <exclude name="**/LocalStrings_*" />
       </fileset>
     </jar>

     <!-- Jasper EL Implementation JAR File -->
     <jar  jarfile="${jasper-el.jar}" index="true">
       <fileset dir="${tomcat.classes}">
         <include name="org/apache/el/**" />
         <!-- Javadoc and i18n exclusions -->
         <exclude name="**/package.html" />
         <exclude name="**/LocalStrings_*" />
       </fileset>
     </jar>

  </target>

  <target name="deploy" depends="build-only">

    <copy file="${commons-logging-api.jar}" todir="${tomcat.build}/lib" />

    <!-- Copy static resource files -->
    <copy todir="${tomcat.build}/conf">
      <fileset dir="conf">
        <include name="*.xml"/>
        <include name="*.properties"/>
      </fileset>
    </copy>

  </target>

  <target name="clean">
    <delete dir="${tomcat.classes}" />
    <delete dir="${tomcat.build}" />
  </target>
  
</project>
