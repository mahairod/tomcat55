<project name="Servlet API Classes Nightly Distribution" default="all" basedir=".">

  <!-- Build Management Properties

    buildSAPI.archive        Distribution directory to be archived
    buildSAPI.cvsRoot        CVS login root for Ant
    buildSAPI.dist           Distribution directory produced by "build" target
    buildSAPI.name           Base name of packaged distribution files
    buildSAPI.package        CVS package name for Ant
    buildSAPI.server         Jakarta server's nightly builds directory
    buildSAPI.source         Directory into which Ant sources are extracted
    buildSAPI.uploads	     Directory into which archives to upload are made
    jaxp.home                Home directory of the JAXP distribution

  -->

  <property name="buildSAPI.archive"      value="archive/jakarta-servletapi"/>
  <property name="buildSAPI.cvsRoot"      value=":pserver:anoncvs@jakarta.apache.org:/home/cvspublic"/>
  <property name="buildSAPI.dist"         value="dist/servletapi"/>
  <property name="buildSAPI.name"         value="jakarta-servletapi"/>
  <property name="buildSAPI.package"      value="jakarta-servletapi"/>
  <property name="buildSAPI.server"       value="/www/jakarta.apache.org/builds/servletapi/nightly"/>
  <property name="buildSAPI.source"       value="jakarta-servletapi"/>
  <property name="buildSAPI.uploads"      value="uploads/servletapi"/>

  <!-- Extract the most recent sources from the CVS repository -->
  <target name="extract">
    <deltree dir="${buildSAPI.source}"/>
    <cvs cvsRoot="${buildSAPI.cvsRoot}" package="${buildSAPI.package}"
         dest="${buildSAPI.source}"/>
  </target>

  <!-- Build the distribution according to its instructions -->
  <target name="build">
    <ant dir="${buildSAPI.source}" target="clean"/>
    <ant dir="${buildSAPI.source}" target="dist"/>
  </target>

  <!-- Insert add-ons as required for the nightly distribution -->
  <target name="addons">
    <!-- No addons required -->
  </target>

  <!-- Package up the distribution in various formats -->
  <target name="package">
    <!-- Recreate the archive directory -->
    <deltree dir="${buildSAPI.archive}"/>
    <mkdir   dir="${buildSAPI.archive}"/>
    <copydir src="${buildSAPI.dist}" dest="${buildSAPI.archive}"/>
    <!-- Recreate the uploads directory -->
    <deltree dir="${buildSAPI.uploads}"/>
    <mkdir dir="${buildSAPI.uploads}"/>
    <!-- Create the uploadable files in various formats -->
    <tstamp/>
    <tar tarfile="${buildSAPI.uploads}/${buildSAPI.name}-${DSTAMP}.tar"
         basedir="${buildSAPI.archive}/.."/>
    <gzip    src="${buildSAPI.uploads}/${buildSAPI.name}-${DSTAMP}.tar"
         zipfile="${buildSAPI.uploads}/${buildSAPI.name}-${DSTAMP}.tar.gz"/>
    <exec    dir="${buildSAPI.uploads}"
         command="compress ${buildSAPI.name}-${DSTAMP}.tar"/>
    <zip zipfile="${buildSAPI.uploads}/${buildSAPI.name}-${DSTAMP}.zip"
         basedir="${buildSAPI.archive}/.."/>
  </target>

  <!-- Install the distributable files to the Jakarta server -->
  <!-- Obviously, this will only work right on the real server!!! -->
  <target name="install">
    <copydir src="${buildSAPI.uploads}" dest="${buildSAPI.server}"
             includes="${buildSAPI.name}-${DSTAMP}.*"/>
    <chmod   src="${buildSAPI.server}/${buildSAPI.name}-${DSTAMP}.*"
             perm="g+w"/>
    <chmod   src="${buildSAPI.server}/${buildSAPI.name}-${DSTAMP}.*"
             perm="o+r"/>
  </target>

  <!-- All-in-one target (except for install) -->
  <target name="all" depends="extract,build,addons,package"/>

</project>
