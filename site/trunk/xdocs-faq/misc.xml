<?xml version="1.0"?>
<!DOCTYPE document [
  <!ENTITY project SYSTEM "project.xml">
]>
<document url="misc.html">

  &project;

  <properties>
    <author email="funkman@apache.org">Tim Funk</author>
    <author email="yoavs@apache.org">Yoav Shapira</author>
    <title>Miscellaneous Questions</title>
  </properties>

<body>


<section name="Preface">
  This section contains various miscellaneous questions that are
  asked frequently enough to be listed here.
</section>

<section name="Questions">
<p>
  <ul>
    <li>
      <a href="#tomcat5CharEncoding">
        I'm having a problem with character encoding in tomcat 5.
      </a>
    </li>
    <li>
      <a href="#tomcat4127webappReloading">
        I have a problem with webapp reloading in tomcat 4.1.27.
      </a>
    </li>
    <li>
      <a href="#compile">
        I am unable to compile my JSP!
      </a>
    </li>
    <li>
      <a href="#invoker">
        I can't get servlets to work under <code>/servlet/*</code>!
      </a>
    </li>
    <li>
      <a href="#evil">
        Why is the invoker evil?
      </a>
    </li>
    <li>
      <a href="#version">
        How to I get Tomcat's version number?
      </a>
    </li>
    <li>
      <a href="#cpu">
        Tomcat eats 100% of the CPU!
      </a>
    </li>
    <li>
      <a href="#properties">
        How do I set system properties at startup?
      </a>
    </li>
    <li>
      <a href="#error">
        How do I get a customized error page?
      </a>
    </li>
    <li>
      <a href="#le">
        Should I use the LE version?
      </a>
    </li>
    <li>
      <a href="#persist">
        How do I configure Tomcat to NOT to store the sessions during shutdown?
      </a>
    </li>
    <li>
      <a href="#tagpool">
        How do I disable tag pooling?
      </a>
    </li>
    <li>
      <a href="#dtd">
        Is there a DTD for server.xml?
      </a>
    </li>
    <li>
      <a href="#welcome">
        How do I change the welcome file?
            (I want to show index.jsp instead of index.html)
      </a>
    </li>
    <li>
      <a href="#listing">
        How do I enable/disable directory listings?
      </a>
    </li>
    <li>
      <a href="#ip">
        How do I make Tomcat listen on a specific IP
            address instead of all available addresses?
      </a>
    </li>
    <li>
      <a href="#symlink">
        How do I use symbolic links with jars?
      </a>
    </li>
    <li>
      <a href="#utf8">
        How do I get UTF-8?
      </a>
    </li>
    <li>
      <a href="#saveas">
        How do I change the name of the file in the download Save-As dialog
        from a servlet? (or jsp)
      </a>
    </li>
    <li>
      <a href="#tagbroken">
        Is tag pooling broken? It doesn't call release!
      </a>
    </li>
    <li>
      <a href="#illegalstate">
        Why do I get <code>java.lang.IllegalStateException</code>?
      </a>
    </li>
    <li>
      <a href="#schedule">
        How do I make a scheduled event on Tomcat?
      </a>
    </li>
    <li>
      <a href="#baddtd">
        What is <code>Element "web-app" does not allow "servlet" here</code>?
      </a>
    </li>
    <li>
      <a href="#catalina.out">
        Where does System.out go? <br />
        How do I rotate catalina.out?
      </a>
    </li>
    <li>
      <a href="#getResourceAsStream">
        How do open a file for reading in my webapp?
      </a>
    </li>
    <li>
      <a href="#fullJdk">
        Can I run tomcat with the JRE only, or do I need the full JDK?
      </a>
    </li>
    <li>
      <a href="#ejb">
        Is tomcat an EJB server?  Can I use EJBs with tomcat?
      </a>
    </li>
    <li>
      <a href="#externalJndi">
        Can I access Tomcat's JNDI provider from outside tomcat?
      </a>
    </li>
    <li>
      <a href="#productionStories">
        Who uses tomcat in production?
      </a>
    </li>
    <li>
      <a href="#commonsLoggingLog4j">
        How do I configure commons-logging and log4j in tomcat 5?
      </a>
    </li>
  </ul>
</p>

</section>


<section name="Answers">
  <question>
    <a name="tomcat5CharEncoding">
      I'm having a problem with character encoding in tomcat 5.
    </a>
  </question>
  <answer>
    In Tomcat 5 - there have been issues with respect to character encoding.
    ( Usually of the the form "<tt>request.setCharacterEncoding(String) doesn't work</tt>" )
    Odds are, its not a bug. Before filing a bug report, see these bug reports as well
    as any bug reports linked to these bug reports:
    <a href="http://nagoya.apache.org/bugzilla/show_bug.cgi?id=23929">23929</a>,
    <a href="http://nagoya.apache.org/bugzilla/show_bug.cgi?id=25360">25360</a>,
    <a href="http://nagoya.apache.org/bugzilla/show_bug.cgi?id=25231">25231</a>,
    <a href="http://nagoya.apache.org/bugzilla/show_bug.cgi?id=25235">25235</a>,
    <a href="http://nagoya.apache.org/bugzilla/show_bug.cgi?id=22666">22666</a>,
    <a href="http://nagoya.apache.org/bugzilla/show_bug.cgi?id=24557">24557</a>,
    <a href="http://nagoya.apache.org/bugzilla/show_bug.cgi?id=24345">24345</a>,
    <a href="http://nagoya.apache.org/bugzilla/show_bug.cgi?id=25848">25848</a>
  </answer>

  <question>
    <a name="tomcat4127webappReloading">
      I have a problem with webapp reloading in tomcat 4.1.27.
    </a>
  </question>
  <answer>
    Update to a later tomcat version, preferably the latest stable one.
    If you must stay with 4.1.27, get this hotfix:
    <a href="http://nagoya.apache.org/bugzilla/show_bug.cgi?id=22096">Bugzilla 22096.
    </a>
  </answer>

  <question>
    <a name="compile">I am unable to compile my JSP!</a>
  </question>
  <answer>
    Are you seeing this?
    <pre>
      org.apache.jasper.JasperException: Unable to compile
      class for JSP

      An error occurred at line: -1 in the jsp file: null

      Generated servlet error:
          [javac] Since fork is true, ignoring compiler
      setting.
          [javac] Compiling 1 source file
         [javac] Since fork is true, ignoring compiler
      setting.

    </pre>

    If so, here is some solutions:
    <ul>
      <li>
        <a href="http://marc.theaimsgroup.com/?l=tomcat-user&amp;m=104949554010352&amp;w=2">
          Environment variable issue
        </a>
      </li>
      <li>
        <a href="http://nagoya.apache.org/bugzilla/show_bug.cgi?id=16688">
            Environment issue
        </a>
        or
        <a href="http://nagoya.apache.org/bugzilla/show_bug.cgi?id=20527">
            Ant issue
        </a>
      </li>
      <li>
        Others have had success by added JAVA_HOME/bin to their PATH.
        <a href="http://marc.theaimsgroup.com/?l=tomcat-user&amp;m=105525594928279&amp;w=2">
            1
        </a>

        ...

        <a href="http://marc.theaimsgroup.com/?l=tomcat-user&amp;m=105526353505541&amp;w=2">
            2
        </a>
        and make sure you are using the full JDK and not the JRE.
      </li>
     </ul>

    In the case of the Environment issues, it is typical that on Windows, the
    startup scripts work fine and the service does not. The service uses
    registry values to look for java and other "stuff". To save yourself some
    trouble, see if the
    <a href="http://web.bvu.edu/staff/david/tcservcfg/">
                NT Service Config Utility
    </a> is helpful.
    </answer>


    <question>
      <a name="invoker">
        I can't get servlets to work under <code>/servlet/*</code>!
      </a>
    </question>
    <answer>
        Using <code>/servlet/</code> to map servlets is evil, absolutely evil.
        Even more evil than
        <a href="http://www.eviloverlord.com/lists/overlord.html">
          this
        </a>.

        That being said, here are some threads that may answer this:
        <ul>
          <li>
            <a href="http://marc.theaimsgroup.com/?l=tomcat-user&amp;m=103417249925541&amp;w=2">
              [SECURITY] Apache Tomcat 4.x JSP source disclosure vulnerability
            </a>
          </li>
          <li>
            <a href="http://marc.theaimsgroup.com/?t=103945337100003&amp;r=1&amp;w=2">
              Cannot Run Servlets, only JSP's, Part II
            </a>
          </li>
          <li>
            <a href="http://marc.theaimsgroup.com/?t=104326854100001&amp;r=1&amp;w=2">
              Tomcat configuration problem: JSPs work, servlets don
            </a>
          </li>
        </ul>

      <br /><br />
      For another explanation of the invoker servlet, why it's evil,
      and what to do about it, see
      <a href="http://test.javaranch.com/wiki/view?InvokerServlet">JavaRanch FAQ</a>.
    </answer>


  <question>
    <a name="evil">Why is the invoker evil?</a>
  </question>
  <answer>
    <i>This is opinions of the writer (YMMV)</i> <br />
    <em>Quickie about the invoker:</em> The invoker is a dynamic servlet which
    allows run-time
    loading of other servlets based on class name. This servlet is the one
    that allows
    <code>http://localhost/servlet/com.foo.MyClass?more=cowbell</code>, where
    <code>com.foo.MyClass</code> is some class which can be loaded as
    a servlet but was never explicitly declared in a config file.

    <br /><br />

    Evil because:
    <ul>
      <li>Security risk ... see links above</li>
      <li>
        Configuration hiding - There is NO way to determine which servlets are
        used vs which are not used. In web.xml, every servlet is declared
        and mapped.
        In that one file you instantly have a road map to how the webapp works.
      </li>
      <li>
        Back doors. Servlets which <b>are</b> mapped can be alternately
        called via the
        invoker by class name. Since the URL is different, all security
        constraints might be ignored since the URL pattern is VERY different.
      </li>
      <li>
        Back doors. Bad programmers make it easier to do bad things.
      </li>
      <li>
        Back doors. It may be common to use common 3rd party jars in a
        shared area. If that shared jar has servlets in them and that servlet
        has a hole in it, bad things happen.
      </li>
      <li>
        Configuration hiding - it's important enough to say twice. Explicit
        declaration while a PITA, will be more helpful in the maintenance
        scheme of your webapp.
      </li>
    </ul>

    <br /><br />
    For another explanation of the invoker servlet, why it's evil,
    and what to do about it, see
    <a href="http://test.javaranch.com/wiki/view?InvokerServlet">JavaRanch FAQ</a>.
  </answer>


  <question>
    <a name="version">How to I get Tomcat's version number?</a>
  </question>
  <answer>
    <code>javax.servlet.ServletContext.getServerInfo();</code>
  </answer>

  <question>
    <a name="cpu">Tomcat eats 100% of the CPU!</a>
  </question>
  <answer>
    Odds are, it might be the garbage collector going wacky. <br /> <br />

    In 1.4.1 JVMs there is a memory leak which could hampering the
    garbage collector.
    <a href="http://developer.java.sun.com/developer/bugParade/bugs/4724129.html">
       More information
    </a>

    Otherwise - get a memory profiler and/or tweak your memory settings.
  </answer>



  <question>
    <a name="properties">
        How do I set system properties at startup?
    </a>
  </question>
  <answer>
    Set <code>JAVA_OPTS</code> to be something BEFORE calling startup.bat
    or before calling catalina.bat. (or you can edit those files, but it
    isn't advised)

    <br /><br />

    <em>Example (windows): </em>
    <code>SET JAVA_OPTS='-DpropName=propValue'</code>
    <br /><br />

    <em>Example (UNIX): </em>
    <code>export JAVA_OPTS='-DpropName=propValue'</code>

    <br /><br />

    Windows service users -
            <a href="http://web.bvu.edu/staff/david/tcservcfg/">
             use this</a>
  </answer>


  <question>
    <a name="error">
      How do I get a customized error page?
    </a>
  </question>
  <answer>
    In web.xml ...
    <pre>
        &lt;error-page&gt;
            &lt;error-code&gt;404&lt;/error-code&gt;
            &lt;location&gt;/error/404.html&lt;/location&gt;
        &lt;/error-page&gt;
    </pre>

    You may also catch error 500's as well as other specific exceptions or
    exceptions which extend <tt>Throwable</tt>.
    <br/>
    For more information, see the Servlet Specification for all the gory
    details of how you can play with this.
  </answer>


  <question>
    <a name="le">Should I use the LE version?</a>
  </question>
  <answer>
    No. It was an experiment, it failed. (YMMV) The original purpose
    of LE was because jdk1.4 provides a LOT of standard functionality
    that Tomcat uses that was not in jdk1.3. So to save some space
    two distributions were made to save some bandwidth. Since then,
    it has been an exercise in confusion. (Flame me if you disagree)
    <a href="http://marc.theaimsgroup.com/?l=tomcat-user&amp;=105341005928071&amp;w=2">
        More info
    </a>
  </answer>



  <question>
    <a name="persist">
      How do I configure Tomcat to NOT to store the sessions during shutdown?
    </a>
  </question>
  <answer>
    <a href="http://jakarta.apache.org/tomcat/tomcat-4.1-doc/config/manager.html">
        Look at the Session manager component and tweak accordingly.
        One way is to tell tomcat to persist sessions to a path
        which does not exist. (So tomcat will not store, or be able to load the sessions)
    </a>
  </answer>



  <question>
    <a name="tagpool">
      How do I disable tag pooling?
    </a>
  </question>
  <answer>
    To disable tag pooling:
    See $TOMCAT_HOME/conf/web.xml --> enablePooling=false for the jsp servlet
    declaration.
  </answer>



  <question>
      <a name="dtd">
        Is there a DTD for server.xml?
      </a>
  </question>
  <answer>
    No! Nor can one accurately exist.
    <a href="http://marc.theaimsgroup.com/?l=tomcat-user&amp;m=104205666221372&amp;w=2">
       Here's why
    </a>
  </answer>


  <question>
      <a name="welcome">
        How do I change the welcome file? (
                I want to show index.jsp instead of index.html)
      </a>
  </question>
  <answer>
    This is done in web.xml by changing <code>welcome-files-list</code>.
    <a href="http://marc.theaimsgroup.com/?l=tomcat-user&amp;m=104566785828794&amp;w=2">
      More detail.
    </a>
  </answer>


  <question>
      <a name="listing">
        How do I enable/disable directory listings?
      </a>
  </question>
  <answer>
    This is done in TOMCAT_HOME/conf/web.xml by changing the <code>listings</code>
    property for the <code>default</code> servlet.
  </answer>


  <question>
      <a name="ip">
        How do I make Tomcat listen on a specific IP
            address instead of all available addresses?
      </a>
  </question>
  <answer>
     RTFM! [Add the property <code>address='127.0.0.1'</code>
     to your Connector config.]
     For more detail:
     <a href="http://jakarta.apache.org/tomcat/tomcat-4.1-doc/config/jk.html">
        JK</a>,
     <a href="http://jakarta.apache.org/tomcat/tomcat-4.1-doc/config/http11.html">
        http</a> (legacy),
     <a href="http://jakarta.apache.org/tomcat/tomcat-4.1-doc/config/coyote.html">
        http</a> (coyote).
  </answer>



  <question>
      <a name="symlink">
        How do I use symbolic links with jars?
      </a>
  </question>
  <answer>
    You'll need to tweak with server.xml and
     <a href="http://marc.theaimsgroup.com/?l=tomcat-user&amp;m=105159411609623&amp;w=2">
         do this.
     </a> (Don't worry - its really easy!)
  </answer>



  <question>
      <a name="utf8">
        How do I get UTF-8?
      </a>
  </question>
  <answer>
    This
     <a href="http://marc.theaimsgroup.com/?t=105524444400002&amp;r=1&amp;w=2">
         thread
     </a>
     should answer that.
  </answer>



  <question>
      <a name="saveas">
        How do I change the name of the file in the download Save-As dialog
        from a servlet? (or jsp)
      </a>
  </question>
  <answer>
    Use the
     <a href="http://www.onjava.com/pub/a/onjava/excerpt/jebp_3/index3.html">
         Content-Disposition
     </a>
     header.
  </answer>



  <question>
      <a name="tagbroken">
        Is tag pooling broken? It doesn't call release!
      </a>
  </question>
  <answer>
    It is not broken, your tag probably is. Many bug reports
    have been filed about this.
     <a href="http://nagoya.apache.org/bugzilla/show_bug.cgi?id=16001">
        Here
     </a>
    is the bug report with all the gory details.
  </answer>




  <question>
      <a name="illegalstate">
        Why do I get <code>java.lang.IllegalStateException</code>?
      </a>
  </question>
  <answer>
    These are the most common reasons how you can get an
    <code>java.lang.IllegalStateException</code>:

    <ul>
      <li>Calling <code>setBufferSize</code> and content has been written.</li>

      <li> The response has been committed and you do any of the following:
       <ul>
        <li>Calling <code>ServletResponse.reset()</code> or
            <code>ServletResponse.resetBuffer()</code>
        </li>

        <li>Calling either <code>HttpServletResponse.sendError()</code>
            or <code>HttpServletResponse.sendRedirect()</code>.
        </li>

        <li>Calling <code>RequestDispatcher.forward()</code> which includes performing
            a <code>jsp:forward</code>
        </li>

        <li>Calling <code>RequestDispatcher.forward()</code> which includes performing
            a <code>jsp:forward</code>
        </li>
       </ul>
      </li>
    </ul>

    Remember that if you call <code>forward()</code> or
    <code>sendRedirect()</code>, any following lines of code will still execute.
    For example:
    <source>
{
  ...
  response.sendRedirect("foo.jsp");
  // At this point, you should probably have a return statement otherwise
  // the following code will run
  System.out.println("After redirect! By the way ...");
  System.out.println("Use commons-logging or log4j, not System.out");
  System.out.println("System.out is a bad practice!");

  response.sendRedirect("bar.jsp"); /* This will throw an error! */

}
    </source>

  </answer>


  <question>
      <a name="schedule">
        How do I make a scheduled event on Tomcat?
      </a>
  </question>
  <answer>
    Tomcat does not support this directly. Its not part of the Servlet or
    JSP Specification. <br/>
    If you do need this functionality see
    <a href="http://marc.theaimsgroup.com/?t=106192918700004&amp;r=1&amp;w=2">
        this thread
    </a> or
    <a href="http://marc.theaimsgroup.com/?l=tomcat-user&amp;m=106157051231075&amp;w=2">
    this link</a>.
  </answer>


  <question>
      <a name="baddtd">
        What is <code>Element "web-app" does not allow "servlet" here</code>?
      </a>
  </question>
  <answer>
    Your web.xml is not well formed or it is not conforming to the DTD as
    defined by the servlet spec. Use an XML validator to ensure
    your web.xml file is ok.
  </answer>


  <question>
      <a name="catalina.out">
        Where does System.out go? <br />
        How do I rotate catalina.out?
      </a>
  </question>
  <answer>
    <code>System.out</code> and <code>System.err</code> both print to
    catalina.out. But you can suppress this via the swallowOutput property and
    sent to different log files.
    <br/>
    catalina.out does not rotate. But it should not be an issue because
    nothing should be printing to standard output since you are using a logging
    package, right?
  <a href="http://marc.theaimsgroup.com/?l=tomcat-user&amp;m=106623436423859&amp;w=2"> A log4j example</a>  and
  <a href="http://marc.theaimsgroup.com/?t=105544472600001&amp;r=1&amp;w=2">a thread about rotation of catalina.out</a>

  </answer>

  <question>
      <a name="getResourceAsStream">
       How do open a file for reading in my webapp?
      </a>
  </question>
  <answer>
    Use <tt>ServletContext.getResourceAsStream()</tt>.
  </answer>

  <question>
    <a name="fullJdk">
      Can I run tomcat with the JRE, or do I need the full JDK?
    </a>
  </question>
  <answer>
    Tomcat officially requires the full JDK, because it needs
    javac in order to compile JSPs.  If you pre-compile all
    your JSPs, you can get away with running tomcat
    on a JRE only, but you do so at your own risk.
  </answer>

  <question>
    <a name="ejb">
      Is tomcat an EJB server?  Can I use EJBs with tomcat?
    </a>
  </question>
  <answer>
    Tomcat is not an EJB server.  Tomcat is not a full J2EE
    server.  Tomcat is a Servlet container.  Tomcat does support
    those parts of the J2EE specification that are required
    for Servlets, such as a subset of JNDI functionality.
    Furthermore, you can connect to remote J2EE servers, or
    run tomcat embedded inside a full J2EE server.
  </answer>

  <question>
    <a name="externalJndi">
      Can I access Tomcat's JNDI provider from outside tomcat?
    </a>
  </question>
  <answer>
    Not at this time.
  </answer>

  <question>
    <a name="productionStories">
      Who uses tomcat in production?
    </a>
  </question>
  <answer>
    Numerous organizations across various industries all over the world.
    Examples includes:
    <ul>
      <li><a href="http://www.computerworld.com/developmenttopics/websitemgmt/story/0,10801,92583,00.html">The Weather Channel</a>.</li>
      <li><a href="http://screaming-penguin.com/main.php?storyid=2579">EdSyndicate</a>.</li>
      <li><a href="http://developers.slashdot.org/developers/02/08/19/2042235.shtml?tid=108">Various (from Slashdot)</a>.</li>
      <li><a href="http://www.theserverside.com/news/thread.tss?thread_id=15073">TheServerSide.com</a> take on the Slashdot discussion above, with many more references.</li>
      <li><a href="http://www.cofax.org">Cofax</a>.</li>
      <li><a href="http://www.friendster.com">Friendster</a>.</li>
      <li><a href="http://www.webshots.com">WebShots</a>.</li>
      <li><a href="http://archives.real-time.com/pipermail/cocoon-users/2003-October/040770.html">Various Cocoon on tomcat applications</a>.</li> 
      <li><a href="http://marc.theaimsgroup.com/?l=tomcat-user&amp;m=108334244910127&amp;w=2">Another mailing list thread with production system references...</a></li>
    </ul>
    This list is limited mostly by our free time.  There are numerous other
    examples and references available by searching online, and undoubtedly
    many cases where the organization does not want to reveal it's using
    tomcat for various (e.g. security) reasons.  (This is true for many
    software products, not just tomcat).  We'll keep adding to the list,
    but please let us know (by sending a message to tomat-user@jakarta.apache.org)
    if your site is using tomcat in production.
  </answer>
 
  <question>
    <a name="commonsLoggingLog4j">
      How do I configure commons-logging and log4j in tomcat 5?
    </a>
  </question>
  <answer>
    See this mailing list <a href="http://marc.theaimsgroup.com/?l=tomcat-user&amp;m=108330970225012&amp;w=2">message.</a>
  </answer>
</section>


</body>
</document>
