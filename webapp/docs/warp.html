<!doctype html public "-//w3c//dtd html 4.0 transitional//en">
<html>
<head>
   <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
   <meta name="GENERATOR" content="Mozilla/4.77 [en] (X11; U; Linux 2.4.7 i686) [Netscape]">
   <title>The WARP Protocol Version 1.0</title>
</head>
<body text="#000000" bgcolor="#FFFFFF" link="#0000FF" vlink="#0000AA">

<center><b><font size=+2>The WARP Protocol Version 1.0.2</font></b></center>

<h1>
<b><font size=+1>Data Packet Structure</font></b></h1>
All data sent on the full duplex connection between the client and server
MUST follow this structure:
<ul>
<li>
Data is sent in packets formed by a header describing some info about the
packet itself followed by a data length and data payload.</li>

<li>
All packets MUST follow big endian style ("network order").</li>

<li>
The packet header is always 24 bits long and follow this format:</li>

<ul>
<li>
Octet 0 (8 bits) contains the packet type.</li>

<li>
Octets 1-2 (16 bits) set the length of the data payload carried by the
packet itself in numbers octets and MAY be zero.</li>

<li>
If the length of the data payload is more than zero, octets from 3 to (length
+ 3) contain the payload data or content.</li>
</ul>
</ul>

<center><table BORDER CELLSPACING=0 CELLPADDING=2 WIDTH="80%" >
<tr>
<td ALIGN=CENTER COLSPAN="15" WIDTH="100%" BGCOLOR="#333333"><b><font color="#FFFFFF"><font size=+1>WARP
Packet</font></font></b></td>
</tr>

<tr>
<td ALIGN=CENTER WIDTH="10%" BGCOLOR="#666666">Octet</td>

<td ALIGN=CENTER COLSPAN="5" WIDTH="20%" BGCOLOR="#6666FF">1</td>

<td ALIGN=CENTER COLSPAN="3" WIDTH="20%" BGCOLOR="#FF6666">2</td>

<td ALIGN=CENTER COLSPAN="3" WIDTH="20%" BGCOLOR="#FF6666">3</td>

<td ALIGN=CENTER COLSPAN="3" WIDTH="30%" BGCOLOR="#66FF66">4 .. (length+3)</td>
</tr>

<tr>
<td ALIGN=CENTER WIDTH="10%" BGCOLOR="#999999">Bits</td>

<td ALIGN=CENTER WIDTH="3%" BGCOLOR="#9999FF">0</td>

<td ALIGN=CENTER WIDTH="3%" BGCOLOR="#9999FF">1</td>

<td ALIGN=CENTER WIDTH="8%" BGCOLOR="#9999FF">..</td>

<td ALIGN=CENTER WIDTH="3%" BGCOLOR="#9999FF">6</td>

<td ALIGN=CENTER WIDTH="3%" BGCOLOR="#9999FF">7</td>

<td ALIGN=CENTER WIDTH="3%" BGCOLOR="#FF9999">0</td>

<td ALIGN=CENTER WIDTH="3%" BGCOLOR="#FF9999">1</td>

<td ALIGN=CENTER COLSPAN="2" WIDTH="28%" BGCOLOR="#FF9999">..</td>

<td ALIGN=CENTER WIDTH="3%" BGCOLOR="#FF9999">14</td>

<td ALIGN=CENTER WIDTH="3%" BGCOLOR="#FF9999">15</td>

<td ALIGN=CENTER WIDTH="3%" BGCOLOR="#99FF99">0</td>

<td ALIGN=CENTER WIDTH="3%" BGCOLOR="#99FF99">1</td>

<td ALIGN=CENTER WIDTH="24%" BGCOLOR="#99FF99">..</td>
</tr>

<tr>
<td ALIGN=CENTER WIDTH="10%" BGCOLOR="#CCCCCC">Description</td>

<td ALIGN=CENTER COLSPAN="5" WIDTH="20%" BGCOLOR="#CCCCFF">Packet Type</td>

<td ALIGN=CENTER COLSPAN="6" WIDTH="40%" BGCOLOR="#FFCCCC">Payload Length</td>

<td ALIGN=CENTER COLSPAN="3" WIDTH="30%" BGCOLOR="#CCFFCC">Payload Data
(Content)</td>
</tr>
</table></center>

<h1>
<b><font size=+1>Payload Structure</font></b></h1>
The payload of a packet can be structured in two ways, depending on its
type: the packet can either contain raw data (such as an HTTP request or
response body) or a combination of numeric values and strings.
<p>By definition a numeric value is a 32 bit signed integer represented
in network byte order (the value of 6 decimal would be represented as 000000000000000000000000000000000110
binary (110 preceeded by 29 zeroes).
<p>A string is defined in the following way: the first two octets represent
the string length as an unsigned 16 bits value. This value indicates the
number of octets that compose the encoded string. The string is not NULL
terminated and is encoded following the UTF-8 standard. For example the
string "fooBar" would be represented as:
<center><table BORDER CELLSPACING=0 CELLPADDING=2 WIDTH="80%" >
<tr>
<td ALIGN=CENTER COLSPAN="13" WIDTH="100%" BGCOLOR="#333333"><b><font color="#FFFFFF"><font size=+1>String</font></font></b></td>
</tr>

<tr>
<td ALIGN=CENTER WIDTH="12%" BGCOLOR="#666666">Octet</td>

<td ALIGN=CENTER COLSPAN="3" WIDTH="11%" BGCOLOR="#6666FF">1</td>

<td ALIGN=CENTER COLSPAN="3" WIDTH="11%" BGCOLOR="#6666FF">2</td>

<td ALIGN=CENTER WIDTH="11%" BGCOLOR="#66FF66">3</td>

<td ALIGN=CENTER WIDTH="11%" BGCOLOR="#66FF66">4</td>

<td ALIGN=CENTER WIDTH="11%" BGCOLOR="#66FF66">5</td>

<td ALIGN=CENTER WIDTH="11%" BGCOLOR="#66FF66">6</td>

<td ALIGN=CENTER WIDTH="11%" BGCOLOR="#66FF66">7</td>

<td ALIGN=CENTER WIDTH="11%" BGCOLOR="#66FF66">8</td>
</tr>

<tr>
<td ALIGN=CENTER WIDTH="12%" BGCOLOR="#999999">Bits</td>

<td ALIGN=CENTER WIDTH="3%" BGCOLOR="#9999FF">0</td>

<td ALIGN=CENTER WIDTH="3%" BGCOLOR="#9999FF">1</td>

<td ALIGN=CENTER COLSPAN="2" WIDTH="10%" BGCOLOR="#9999FF">..</td>

<td ALIGN=CENTER WIDTH="3%" BGCOLOR="#9999FF">14</td>

<td ALIGN=CENTER WIDTH="3%" BGCOLOR="#9999FF">15</td>

<td ALIGN=CENTER COLSPAN="6" WIDTH="66%" BGCOLOR="#99FF99">..</td>
</tr>

<tr>
<td ALIGN=CENTER WIDTH="12%" BGCOLOR="#CCCCCC">Content</td>

<td ALIGN=CENTER COLSPAN="6" WIDTH="22%" BGCOLOR="#CCCCFF">110 bin = 6
dec</td>

<td ALIGN=CENTER WIDTH="11%" BGCOLOR="#CCFFCC">f</td>

<td ALIGN=CENTER WIDTH="11%" BGCOLOR="#CCFFCC">o</td>

<td ALIGN=CENTER WIDTH="11%" BGCOLOR="#CCFFCC">o</td>

<td ALIGN=CENTER WIDTH="11%" BGCOLOR="#CCFFCC">B</td>

<td ALIGN=CENTER WIDTH="11%" BGCOLOR="#CCFFCC">a</td>

<td ALIGN=CENTER WIDTH="11%" BGCOLOR="#CCFFCC">r</td>
</tr>
</table></center>

<h1>
<b><font size=+1>Packet Types</font></b></h1>
The following is a list of packet types and their relative expected responses:
<center><table BORDER CELLSPACING=0 CELLPADDING=2 WIDTH="80%" >
<tr>
<td ALIGN=CENTER COLSPAN="5" WIDTH="100%" BGCOLOR="#333333"><b><font color="#FFFFFF"><font size=+1>Packet/States
Table</font></font></b></td>
</tr>

<tr>
<td ALIGN=CENTER WIDTH="10%" BGCOLOR="#666666">Name</td>

<td ALIGN=CENTER WIDTH="10%" BGCOLOR="#999999">Type</td>

<td ALIGN=CENTER WIDTH="5%" BGCOLOR="#666666">Originator</td>

<td ALIGN=CENTER WIDTH="50%" BGCOLOR="#999999">Description</td>

<td ALIGN=CENTER WIDTH="25%" BGCOLOR="#666666">Expects</td>
</tr>

<tr>
<td>ERROR</td>

<td>0x00</td>

<td>Client Server</td>

<td>One end of the peer notifies
the other of a fatal connection error</td>

<td>N/A</td>
</tr>

<tr>
<td>DISCONNECT</td>

<td>0xfe</td>

<td>Client Server</td>

<td>One end of the peer notifies
the other that the connections is going to be closed</td>

<td>N/A</td>
</tr>

<tr>
<td>FATAL</td>

<td>0xff</td>

<td> Client <br>Serve </td>

<td>A protocol error occourred, the connection must be closed.</td>

<td>N/A</td>
</tr>

<tr>
<td></td>

<td></td>

<td></td>

<td></td>

<td></td>
</tr>

<tr>
<td>CONF_WELCOME</td>

<td>0x01</td>

<td>Server</td>

<td>First message sent by Server after a client connection.</td>

<td>CONF_DEPLOY</td>
</tr>

<tr>
<td>CONF_DEPLOY</td>

<td>0x05</td>

<td>Client</td>

<td>Deploy a web application.</td>

<td>&nbsp;CONF_APPLIC</td>
</tr>

<tr>
<td>CONF_APPLIC</td>

<td>0x06</td>

<td>Server</td>

<td>Application deployed successfully.</td>

<td>CONF_MAP, CONF_DEPLOY</td>
</tr>

<tr>
<td>CONF_MAP</td>

<td>0x07</td>

<td>Client</td>

<td>Require for application mapping information</td>

<td>CONF_MAP_DONE,CONF_MAP_ALLOW,CONF_MAP_DENY</td>
</tr>

<tr>
<td>CONF_MAP_ALLOW</td>

<td>0x08</td>

<td>Server</td>

<td>Allow client to map the request</td>

<td>N/A</td>
</tr>

<tr>
<td>CONF_MAP_DENY</td>

<td>0x09</td>

<td>Server</td>

<td>Deny client to map the request</td>

<td>N/A</td>
</tr>

<tr>
<td>CONF_MAP_DONE</td>

<td>0x0a</td>

<td>Server</td>

<td>All the ALLOW/DENY map have been transfered</td>

<td>CONF_DEPLOY, CONF_DONE</td>
</tr>

<tr>
<td>CONF_DONE</td>

<td>0x0e</td>

<td>Client</td>

<td>Configuration completly sent to the server</td>

<td>CONF_PROCEED</td>
</tr>

<tr>
<td>CONF_PROCEED</td>

<td>0x0f</td>

<td>Server</td>

<td>Server ready to accept requests.</td>

<td>Request elements (REQ_INIT, REQ_CONTENT, REQ_SCHEME, REQ_AUTH, REQ_HEADER,
REQ_SERVER, REQ_CLIENT, REQ_PROCEED)</td>
</tr>

<tr>
<td></td>

<td></td>

<td></td>

<td></td>

<td></td>
</tr>

<tr>
<td>REQ_INIT</td>

<td>0x10</td>

<td>Client</td>

<td>New request.</td>

<td>N/A</td>
</tr>

<tr>
<td>REQ_CONTENT</td>

<td>0x11</td>

<td>Client</td>

<td>Mine type and length</td>

<td>N/A</td>
</tr>

<tr>
<td>REQ_SCHEME</td>

<td>0x12</td>

<td>Client</td>

<td>Scheme</td>

<td>N/A</td>
</tr>

<tr>
<td>REQ_AUTH</td>

<td>0x13</td>

<td>Client</td>

<td>Authentication</td>

<td>N/A</td>
</tr>

<tr>
<td>REQ_HEADER</td>

<td>0x14</td>

<td>Client</td>

<td>Header element</td>

<td>N/A</td>
</tr>

<tr>
<td>REQ_SERVER</td>

<td>0x15</td>

<td>Client</td>

<td>server information</td>

<td>N/A</td>
</tr>

<tr>
<td>REQ_CLIENT</td>

<td>0x16</td>

<td>Client</td>

<td>remote peer information</td>

<td>N/A</td>
</tr>

<tr>
<td>REQ_PROCEED</td>

<td>0x1f</td>

<td>Client</td>

<td>process request</td>

<td>Reponse elements, ASK_SSL, ASK_SSL_CLIENT or CBK_READ.</td>
</tr>

<tr>
<td></td>

<td></td>

<td></td>

<td></td>

<td></td>
</tr>

<tr>
<td>ASK_SSL</td>

<td>0x43</td>

<td>Server</td>

<td>Request SSL information</td>

<td>REP_SSL_NO, REP_SSL</td>
</tr>

<tr>
<td>ASK_SSL_CLIENT</td>

<td>0x44</td>

<td>Server</td>

<td>Request for CC</td>

<td>REP_SSL_NO, REP_SSL_CERT</td>
</tr>

<tr>
<td>REP_SSL_NO</td>

<td>0x5f</td>

<td>Client</td>

<td>SSL information not available.</td>

<td>Reponse elements.</td>
</tr>

<tr>
<td>REP_SSL</td>

<td>0x52</td>

<td>Client</td>

<td>SSL information.</td>

<td>Reponse elements.</td>
</tr>

<tr>
<td>REP_SSL_CERT</td>

<td>0x53</td>

<td>Client</td>

<td>Client certificate.</td>

<td>Reponse elements.</td>
</tr>

<tr>
<td></td>

<td></td>

<td></td>

<td></td>

<td></td>
</tr>

<tr>
<td>CBK_READ</td>

<td>0x40</td>

<td>Server</td>

<td>Request for body data.</td>

<td>CBK_DATA, CBK_DONE</td>
</tr>

<tr>
<td>CBK_DATA</td>

<td>0x41</td>

<td>Client</td>

<td>Chunk of data.</td>

<td>CBK_READ or Reponse elements.</td>
</tr>

<tr>
<td>CBK_DONE</td>

<td>0x42</td>

<td>Client</td>

<td>End of data.</td>

<td>Reponse elements.</td>
</tr>

<tr>
<td></td>

<td></td>

<td></td>

<td></td>

<td></td>
</tr>

<tr>
<td>RES_STATUS</td>

<td>0x20</td>

<td>Server</td>

<td>HTTP status.</td>

<td>N/A</td>
</tr>

<tr>
<td>RES_HEADER</td>

<td>0x21</td>

<td>Server</td>

<td>response header.</td>

<td>N/A</td>
</tr>

<tr>
<td>RES_COMMIT</td>

<td>0x2f</td>

<td>Server</td>

<td>send data to browser.</td>

<td>N/A</td>
</tr>

<tr>
<td>RES_BODY</td>

<td>0x30</td>

<td>Server</td>

<td>data reponse element</td>

<td>N/A</td>
</tr>

<tr>
<td>RES_DONE</td>

<td>0x3f</td>

<td>Server</td>

<td>end of reponse</td>

<td>Request elements.</td>
</tr>
</table></center>

<h1>
<b><font size=+1>Packet Type Details</font></b></h1>

<p><br><b>ERROR</b> 0x00
<br>Specifies an unrecoverable protocol error. After the client or the
server issues this packet the socket underlying the WARP connection must
be closed.
<br>This message can be sent at any time by the client or the server.
<ul>
<li>
[string]: A detail message on why the connection must be closed.</li>
</ul>
<b>DISCONNECT</b> 0xfe
<br>The client or the server is going to close the connection (no fatal
protocol error).
<p><b>FATAL</b> 0x0ff
<br>A protocol error occourred, the connection must be closed.
<ul>
<li>
[string]: An error message.</li>
</ul>
<b>CONF_WELCOME</b> 0x01
<br>The server issues this packet when a connection is opened. The server
awaits for configuration information.
<ul>
<li>
[ushort] Major protocol version.</li>

<li>
[ushort] Minor protocol version.</li>

<li>
[integer] The server unique-id.</li>
</ul>

<p><br><b>CONF_DEPLOY </b>0x05
<br>The client attempts to deploy a web application.
<ul>
<li>
[string] The application name.</li>

<li>
[string] The virtual host name.</li>

<li>
[ushort] The virtual host port.</li>

<li>
[string] The web-application URL path.</li>
</ul>
<b>CONF_APPLIC</b> 0x06
<br>The server replies to a CONF_DEPLOY message with the web application
identifier of the configured application.
<ul>
<li>
&nbsp;[integer] The web application unique id for this server.</li>

<li>
&nbsp;[string] The web application real path (where it's expanded).</li>
</ul>

<p><br><b>CONF_MAP</b> 0x07
<br>The client requests to the server to enumerate all mappings for a specified
web-application. The server replies to this message with a serie of MAP_ALLOW
and MAP_DENY packets, terminated by a MAP_DONE packet.
<ul>
<li>
[integer] The web application unique id for this server.</li>
</ul>
<b>CONF_MAP_ALLOW</b> 0x08:
<br>The server replies to a CONF_MAP message with those packets to indicate
a mapping to a static page, or a resource that can be served autonomously
by the remote end (the web server).
<ul>
<li>
&nbsp;[string] An url-pattern as defined by the Servlet specification.</li>
</ul>

<p><br><b>CONF_MAP_DENY</b> 0x09
<br>The server replies to a CONF_MAP message with those packets to indicate
a mapping to a resource that must be served by the server (servlet container).
<ul>
<li>
&nbsp;[string] An url-pattern as defined by the Servlet specification.</li>
</ul>
<b>CONF_MAP_DONE</b> 0x0a
<br>The server replies to a CONF_MAP message with this packet to indicate
that all servlet mappings have been successfully transfered to the other
end.
<p>&nbsp;<b>CONF_DONE</b> 0x0e
<br>Client issues this message when all configurations have been processed.
<p><b>CONF_PROCEED</b> 0x0f
<br>Server issues this message in response to a CONF_DONE message, to acknowledge
its readiness to accept requests.
<br>&nbsp;
<br>&nbsp;
<br>&nbsp;
<br>&nbsp;
</body>
</html>
