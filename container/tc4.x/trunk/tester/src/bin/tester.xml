<project name="Tester" default="all">

  <!-- ========== Global Properties ======================================= -->
  <property name="catalina.home"  value="../../build/tomcat-4.0"/>
  <property name="host"           value="localhost"/>
  <property name="port"           value="8080"/>
<!--  <property name="protocol"       value="HTTP/1.0"/> -->
  <property name="protocol"       value=""/> <!-- Use HttpURLConnection -->
  <property name="context.path"   value="/tester"/>
  <taskdef  name="tester"     classname="org.apache.tester.TestClient"/>


  <target name="all" depends="ROOT,CaseSensitive,RequestDispatcher,ServletRequest,ServletResponse"/>


  <target name="ROOT">

    <!-- ========== Basic Run State ======================================= -->

    <!-- Should be able to see the home page -->
    <tester host="${host}" port="${port}" protocol="${protocol}"
         request="/index.html"
          status="200"/>

  </target>


  <target name="CaseSensitive">

    <!-- ========== Case Sensitive Request URI Matching =================== -->

    <!-- Make sure that static resources are matched case sensitively -->
    <tester host="${host}" port="${port}" protocol="${protocol}"
         request="/index.HTML"
          status="404"/>

    <!-- Should be able to execute the Date example -->
    <touch  file="${catalina.home}/webapps/examples/jsp/dates/date.jsp"/>
    <tester host="${host}" port="${port}" protocol="${protocol}"
         request="/examples/jsp/dates/date.jsp"
          status="200"/>

    <!-- Should not be able to view the source of the Date example -->
    <touch  file="${catalina.home}/webapps/examples/jsp/dates/date.jsp"/>
    <tester host="${host}" port="${port}" protocol="${protocol}"
         request="/examples/jsp/dates/date.Jsp"
          status="404"/>

    <!-- Should not be able to view the source of the Date example -->
    <touch  file="${catalina.home}/webapps/examples/jsp/dates/date.jsp"/>
    <tester host="${host}" port="${port}" protocol="${protocol}"
         request="/examples/jsp/dates/Date.jsp"
          status="404"/>

    <!-- Should not be able to view the source of the Date example -->
    <touch  file="${catalina.home}/webapps/examples/jsp/dates/date.jsp"/>
    <tester host="${host}" port="${port}" protocol="${protocol}"
         request="/examples/jsp/Dates/date.jsp"
          status="404"/>

    <!-- Should not be able to view the source of the Date example -->
    <touch  file="${catalina.home}/webapps/examples/jsp/dates/date.jsp"/>
    <tester host="${host}" port="${port}" protocol="${protocol}"
         request="/examples/Jsp/dates/date.jsp"
          status="404"/>

    <!-- Should not be able to view the source of the Date example -->
    <touch  file="${catalina.home}/webapps/examples/jsp/dates/date.jsp"/>
    <tester host="${host}" port="${port}" protocol="${protocol}"
         request="/Examples/jsp/dates/date.jsp"
          status="404"/>

    <!-- Should be able to execute the HelloWorld servlet example -->
    <tester host="${host}" port="${port}" protocol="${protocol}"
         request="/examples/servlet/HelloWorldExample"
          status="200"/>

    <!-- Should not be able to execute HelloWorld with different cases -->
    <tester host="${host}" port="${port}" protocol="${protocol}"
         request="/examples/servlet/helloWorldExample"
          status="404"/>

    <!-- Should not be able to execute HelloWorld with different cases -->
    <tester host="${host}" port="${port}" protocol="${protocol}"
         request="/examples/Servlet/HelloWorldExample"
          status="404"/>

    <!-- Should not be able to execute HelloWorld with different cases -->
    <tester host="${host}" port="${port}" protocol="${protocol}"
         request="/Examples/servlet/HelloWorldExample"
          status="404"/>

  </target>


  <target name="RequestDispatcher">

    <!-- ========== Forward and Include to Static Resource ================ -->

    <tester host="${host}" port="${port}" protocol="${protocol}"
         request="${context.path}/Forward01"
      outContent="Forward01 PASSED"/>

    <tester host="${host}" port="${port}" protocol="${protocol}"
         request="${context.path}/WrappedForward01"
      outContent="Forward01 PASSED"/>

    <tester host="${host}" port="${port}" protocol="${protocol}"
         request="${context.path}/Include01"
      outContent="Include01 PASSED"/>

    <tester host="${host}" port="${port}" protocol="${protocol}"
         request="${context.path}/WrappedInclude01"
      outContent="Include01 PASSED"/>

  </target>


  <target name="ServletRequest">

    <!-- ========== Parameters and Query Strings ========================== -->

    <tester host="${host}" port="${port}" protocol="${protocol}"
         request="${context.path}/GetParameter01?foo=1"
      outContent="GetParameter01 PASSED"/>

    <tester host="${host}" port="${port}" protocol="${protocol}"
         request="${context.path}/WrappedGetParameter01?foo=1"
      outContent="GetParameter01 PASSED"/>

    <tester host="${host}" port="${port}" protocol="${protocol}"
         request="${context.path}/GetParameterMap00?BestLanguage=Java&amp;BestJSP=Java2"
      outContent="GetParameterMap00 PASSED"/>

    <tester host="${host}" port="${port}" protocol="${protocol}"
         request="${context.path}/WrappedGetParameterMap00?BestLanguage=Java&amp;BestJSP=Java2"
      outContent="GetParameterMap00 PASSED"/>

    <tester host="${host}" port="${port}" protocol="${protocol}"
         request="${context.path}/GetQueryString01?foo=1"
      outContent="GetQueryString01 PASSED"/>

    <tester host="${host}" port="${port}" protocol="${protocol}"
         request="${context.path}/WrappedGetQueryString01?foo=1"
      outContent="GetQueryString01 PASSED"/>

    <!-- ========== Other ServletRequest Tests ============================ -->

    <!-- Servlet compliance tests, until equivalent tests are included
         in jakarta-watchdog-4.0.  -->

    <!-- HttpURLConnection does not handle multiple headers for the same
         name correctly, so use native socket connections, selected by
         setting the protocol to "HTTP/1.0" -->

    <tester host="${host}" port="${port}" protocol="HTTP/1.0"
         request="${context.path}/GetHeaders01"
       inHeaders="Accept-Language:en-us##Accept-Language:en-gb"
      outContent="GetHeaders01 PASSED"/>

    <tester host="${host}" port="${port}" protocol="HTTP/1.0"
         request="${context.path}/WrappedGetHeaders01"
       inHeaders="Accept-Language:en-us##Accept-Language:en-gb"
      outContent="GetHeaders01 PASSED"/>

    <tester host="${host}" port="${port}" protocol="${protocol}"
         request="${context.path}/GetInputStream01"
      outContent="GetInputStream01 PASSED"/>

    <tester host="${host}" port="${port}" protocol="${protocol}"
         request="${context.path}/WrappedGetInputStream01"
      outContent="GetInputStream01 PASSED"/>


    <!-- ========== Authentication ======================================== -->

    <!-- Once a user has been authenticated, the corresponding user identity
         should be visible to all other requests in this web application, even
         for URIs that are not protected by security constraints.  This is
         tested by invoking a protected URI followed by a non-protected URI
    -->

    <tester host="${host}" port="${port}" protocol="${protocol}"
         request="${context.path}/protected/Authentication01"
       inHeaders="Authorization:Basic dG9tY2F0OnRvbWNhdA=="
      outContent="Authentication01 PASSED"/>

    <tester host="${host}" port="${port}" protocol="${protocol}"
         request="${context.path}/protected/Authentication02"
       inHeaders="Authorization:Basic dG9tY2F0OnRvbWNhdA=="
      outContent="Authentication02 PASSED"/>


  </target>


  <target name="ServletResponse">


    <!-- ========== Other ServletResponse Tests =========================== -->

    <tester host="${host}" port="${port}" protocol="${protocol}" debug="0"
         request="${context.path}/Reset01"
      outContent="Reset01 PASSED"/>

    <tester host="${host}" port="${port}" protocol="${protocol}" debug="0"
         request="${context.path}/WrappedReset01"
      outContent="Reset01 PASSED"/>

    <tester host="${host}" port="${port}" protocol="${protocol}" debug="0"
         request="${context.path}/SetBufferSize01"
      outContent="SetBufferSize01 PASSED"/>

    <tester host="${host}" port="${port}" protocol="${protocol}" debug="0"
         request="${context.path}/WrappedSetBufferSize01"
      outContent="SetBufferSize01 PASSED"/>

    <tester host="${host}" port="${port}" protocol="${protocol}" debug="0"
         request="${context.path}/SetLocale01"
      outContent="SetLocale01 PASSED"
      outHeaders="Content-Language:en"/>

    <tester host="${host}" port="${port}" protocol="${protocol}" debug="0"
         request="${context.path}/WrappedSetLocale01"
      outContent="SetLocale01 PASSED"
      outHeaders="Content-Language:en"/>


  </target>


</project>
