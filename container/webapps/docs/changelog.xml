<?xml version="1.0"?>
<!DOCTYPE document [
  <!ENTITY project SYSTEM "project.xml">
]>
<document url="changelog.html">

  &project;

  <properties>
    <author email="remm@apache.org">Remy Maucherat</author>
    <title>Changelog</title>
  </properties>

<body>

<section name="Tomcat 5.0.3 (remm)">

  <subsection name="General">

    <changelog>

      <update>
      Upgrade to commons-el 1.0 (remm)
      </update>
      <update>
      Split main Catalina JAR, and move i18n related resource files to separate
      JARs (remm)
      </update>
      <fix>
      <bug>19808</bug>: Add the sit MIME mapping (funkman)
      </fix>
      <fix>
      <bug>20263</bug>: Fix problems running Tomcat with procrun as a Windows 
      service, submitted by Mladen Turk (remm)
      </fix>
      <update>
      Package Unix source from commons-daemon in the Tomcat distribution, so
      that the Unix wrapper can easily be used if needed (remm)
      </update>
      <update>
      Upgrade to commons-fileupload 1.0 RC 1, submitted by Martin Cooper 
      (billbarker)
      </update>
      <scode>
      Fix the netbuild (remm)
      </scode>
      <update>
      Specification schema changes, submitted by Mark Roth (kinman)
      </update>
      <update>
      Many tag handling specification clarifications, submitted by Mark Roth 
      (kinman)
      </update>

    </changelog>

  </subsection>

  <subsection name="Catalina">

    <changelog>

      <fix>
      Fix JMX registration order again during context startup: the object name
      is constructed before the pipeline initialization, but the JMX 
      registration only occurs after the context is started (remm)
      </fix>
      <fix>
      Properly close WARs after expanding them in the deployer (remm)
      </fix>
      <update>
      Fix handling of invalid WARs during auto deploy, which will be logged 
      as a simple WARN without a stack trace, and reattempt deployment later
      (remm)
      </update>
      <fix>
      Dig as deep as possible to display possible nesting of ServletExceptions
      (funkman)
      </fix>
      <fix>
      Fix NPE exception in classloader when an invalid war file is deployed
      (jfarcand)
      </fix>
      <fix>
      Container incorrectly processes invalid URL patterns in 
      jsp-property-groups (jfarcand)
      </fix>
      <add>
      Add optional XSL processing to the output of the default servlet, as well
      the ability to include a readme file, similar to Apache (funkman)
      </add>
      <scode>
      Remove bundled support for Tyrex (remm)
      </scode>
      <fix>
      Comment out invoker servlet declaration (remm)
      </fix>
      <update>
      Move context descriptors to $CATALINA_BASE/conf/[engine name]/[host name]
      to make the feature more secure (remm)
      </update>
      <update>
      Update the host properties: liveDeploy becomes autoDeploy (dynamically
      deploy and update web applications), and autoDeploy becomes 
      deployOnStartup (deploy webapps from appBase on startup) (remm)
      </update>
      <fix>
      Remove thread local caching in the default servlet, which was causing
      a memory leak (remm)
      </fix>
      <add>
      Add a mechanism to allow the classloader to release JAR file handles 
      periodically (remm)
      </add>
      <fix>
      <bug>20758</bug>: Remove a number of leaked references to the context
      object, so it can be properly garbage collected when the application
      is removed (remm)
      </fix>
      <fix>
      Do JMX registration of the context before starting the piepline (remm)
      </fix>
      <update>
      Replace Catalina TLD-inside-JAR parsing code with a file based algorithm
      (remm)
      </update>
      <update>
      ServletContext.getResource for a JAR resource located inside /WEB-INF/lib
      will return a file based URL (remm)
      </update>
      <update>
      The special directories /WEB-INF/classes and /WEB-INF/lib are now 
      considered to be non cacheable, in order to conserve cache space (remm)
      </update>
      <fix>
      Clear out constructs used for classloading, after a class has been 
      successfully loaded (remm)
      </fix>
      <update>
      Generalize WAR unpacking, based on the unpackWARs flag (remm)
      </update>
      <update>
      Track WARs for changes when WARs are unpacked: if the WAR is updated
      the web application will be redeployed (remm)
      </update>
      <scode>
      Remove CertificatesValve, as it is useless with Coyote, and introduces
      a hard dependency on JSSE (billbarker)
      </scode>
      <update>
      Add caching mechanism for invocation of methods using privileged actions
      (jfarcand)
      </update>
      <fix>
      <bug>20380</bug>: AccessLogValve incorrectly calculates timezone, 
      <bug>16374</bug>: Date in file name configurable, <bug>16400</bug>:
      Allow logging to be conditional (funkman)
      </fix>
      <add>
      W3C Extended Log File Format support (funkman)
      </add>
      <update>
      Refactor FORM using a forward, based on the patch by Jeff Tulley (remm)
      </update>
      <fix>
      Properly set the wrapped request dispatcher state, submitted by Jan Luehe
      (remm)
      </fix>
      <update>
      Have all contexts inherit Embedded's logger (luehe)
      </update>
      <update>
      Add logging of unexpected exceptions occuring during reference resolution
      (remm)
      </update>
      <fix>
      unbindClassLoader was thorwing NPE when newly added context 
      was removed (amyroh)
      </fix>
      <fix>
      Fix Gump failure by copying the Ant JAR manually (jfarcand)
      </fix>
      <update>
      Update confidential HTTPS redirection without using an actual URL,
      which has a hard JSSE dependency (remm)
      </update>
      <add>
      Include updated clustering code (fhanik, remm)
      </add>
      <update>
      Remove useless typecasts in the main processing pipeline, and make
      critical methods final, to enforce the Catalina design pattern (remm)
      </update>
      <update>
      Request dispatcher optimizations, based on the belief that wrapping 
      is only needed (if at all) for the special attributes (remm)
      </update>
      <update>
      Major filter mapping optimization, using simple String region matching,
      as well as synchronization removal (remm)
      </update>
      <add>
      Add new callback on the container interface to process any background
      task the container may have (backgroundProcess), as well as a new
      backgroundProcessor attribute (default value: 10s for the engine
      container, and -1 for all others, so that only the engine has an
      associated thread) (remm)
      </add>
      <add>
      Refactor application reloading, deployment handling and session 
      expiration to be able to use a single thread per Catalina engine, opposed
      to one thread per feature per webapp or virtual host; this should save
      resources and make Tomcat suitable for large scale web hosting; 
      individual containers can still "own" their own reloading thread 
      if they need to (remm)
      </add>
      <fix>
      Fix a bug where the context is not registered again in JMX after a 
      stop/start, which would break mapping (remm)
      </fix>
      <update>
      Implement context reloading as stop, followed by start, in an attempt
      to avoid code duplication and clear user confusion on what a reload 
      exactly does (remm)
      </update>
      <update>
      Pass the request URI as a parameter to the request dispatcher, as this 
      avoids rebuilding it (remm)
      </update>
      <fix>
      Unify the way we shutdown the server, and fix a classloading problem 
      when the digester file are under common/lib instead of server/lib 
      (jfarcand)
      </fix>
      <fix>
      Do not register a StandardContext instance when the context is stopped 
      (undeployed) (remm)
      </fix>
      <scode>
      Remove the old Catalina mapper (remm)
      </scode>
      <update>
      Swicth to the "new" mapper for request dispatcher mapping (remm)
      </update>
      <fix>
      <bug>20018</bug>: ErrorPage directive doesn't work for http error codes 
      (400,500,..) (remm)
      </fix>
      <update>
      Remove synchronized block on the request dispatcher wrapper request,
      submitted by Remy Maucherat (jfarcand)
      </update>
      <fix>
      Allow the getAttribute() method access to the wrapped request object 
      (like setAttribute/removeAttribute) (jfarcand)
      </fix>
      <update>
      Add the rest of missing attributes for j2eeType=WebModule and Servlet
      (amyroh)
      </update>
      <scode>
      Remove redundant commons-beanutils JAR (remm)
      </scode>
      <update>
      Isolate the validating digester creation so that the code can be reused
      (remm)
      </update>
      <fix>
      Fix to unregister valves that are other than Lifecycle 
      - RequestDumperValve (amyroh)
      </fix>
      <fix>
      Service.removeConnector doesn't unregister connector mbeans; call 
      connector.destroy to unregister (amyroh)
      </fix>
      <fix>
      Return null for objectName when initialization fails (amyroh)
      </fix>
      <update>
      Make objectName attribute visible for j2eeType=Servlet mbean (amyroh)
      </update>
      <fix>
      Register valve in JMX even if it's not an instance of Lifecycle (amyroh)
      </fix>
      <update>
      Add support for OS/400 in the Catalina shell scripts, submitted 
      by Robert Upshall (jfclere)
      </update>
      <fix>
      Improve logic for setWrapper call for privileged webapps (costin)
      </fix>

    </changelog>

  </subsection>

  <subsection name="Coyote">

    <changelog>

      <fix>
      Fix access to the remote address of a request object with JMX (remm)
      </fix>
      <fix>
      Fix CLIENT-CERT authentication when using PureTLS (billbarker)
      </fix>
      <update>
      Allow setting arbitrary attributes on the HTTP/1.1 protocol handler
      (billbarker)
      </update>
      <update>
      Improve support for JSSE 1.1.x, and refactor introspection code in the
      factory (billbarker)
      </update>
      <fix>
      RFC 2109 cookies with quoted values are not processed properly (luehe)
      </fix>
      <fix>
      Check for the existence of the class before trying to load the JK adapter
      to avoid useless error logging (funkman)
      </fix>
      <fix>
      Fix the request state to allow the use of the request dispatcher from
      outside the filter pipeline (remm)
      </fix>
      <fix>
      Commit the response even if the buffer is empty when flushing (remm)
      </fix>
      <fix>
      ServletResponse.getLocale returns en_US instead of container (luehe)
      </fix>
      <fix>
      Filter out CRLF from the message text (remm)
      </fix>
      <update>
      Pass through all connector parameters to the Coyote protocol handler,
      which will allow custom initialization parameters for SSL, for example
      (billbarker)
      </update>
      <fix>
      Remove duplicate request field in the response object (remm)
      </fix>
      <fix>
      Correctly handle redirects sent by the mapper (remm)
      </fix>
      <fix>
      In the mapper, initialize the Context when the object is created (remm)
      </fix>
      <update>
      Add removeWrapper similar to addWrapper to the maper (remm)
      </update>
      <update>
      Refactor very slightly the mapping algorithm and the mapper so that
      it can do context level mapping (remm)
      </update>
      <fix>
      <bug>19991</bug>: Make sure that the SSL-Cert Note gets recycled 
      before processing the request (billbarker)
      </fix>
      <fix>
      Changing to do lazy evaluation of the Servlet-Spec's SSL-attributes
      (billbarker)
      </fix>
      <fix>
      <bug>19958</bug>: IS.read() was actually accessing the char buffer, 
      instead of using the readByte method which correctly uses the byte buffer
      (remm)
      </fix>
      <fix>
      Get rid of the warning in the logs when no Client-Cert is available
      (jfarcand)
      </fix>
      <fix>
      Fix the server user-agent String to be compliant with the HTTP standard
      (remm)
      </fix>
      <update>
      Add new more explicit keep alive property based on the maxKeepAlive value
      (remm)
      </update>
      <fix>
      <bug>19904</bug>: Don't search the query-string or anchor-tag for 
      the protocol (billbarker)
      </fix>
      <fix>
      Robustness: catch exceptions which can occur in prepareRequest (remm)
      </fix>
      <fix>
      ServletResponse.getCharacterEncoding() doesn't return the value specified
      (luehe)
      </fix>
      <fix>
      Incorrect handling of ServletResponse.setLocale (luehe)
      </fix>
      <add>
      Add AOL Server support to JK 2, submitted by Alexander Leykekh (mturk)
      </add>
      <scode>
      Fix javadoc generation for the connectors (costin)
      </scode>

    </changelog>

  </subsection>

  <subsection name="Jasper">

    <changelog>

      <fix>
      <bug>20894</bug>: body-content value of "JSP" should be error 
      if SimpleTag (kinman)
      </fix>
      <fix>
      Swicth back to JSPC forking being false by default (remm)
      </fix>
      <fix>
      Default Jasper to not using caches for opening JAR files, which prevents
      caching (and subsequent locking on Windows) at the JDK level (remm)
      </fix>
      <fix>
      Don't generate a smap for &lt;jsp:attribute&gt; itself, though maps are
      still generated for its body (kinman)
      </fix>
      <fix>
      In a template text, the char after '$' are not handled correctly (kinman)
      </fix>
      <update>
      Only do the security init if there's a security manager (remm)
      </update>
      <fix>
      JSP caches tests Failed-jsp compilation error (luehe)
      </fix>
      <fix>
      Close JARs after parsing their TLDs, regardless of whether the JAR
      contains any packaged tag files (luehe)
      </fix>
      <fix>
      In JspUtil, path is slash, even on windows (kinman)
      </fix>
      <fix>
      Expose root cause of ELExceptions when no error page is defined (luehe)
      </fix>
      <fix>
      Include &lt;jsp:param&gt; when checking if a page is scriptless, 
      submitted by Michael Walker (kinman)
      </fix>
      <fix>
      Set correct class path for tag files, submitted by Michael Walker 
      (kinman)
      </fix>
      <fix>
      EL evaluation error no longer discloses root cause (luehe)
      </fix>
      <fix>
      Exceptions not propagated to JSP error pages (luehe)
      </fix>
      <fix>
      Make sure that the output directory exist, in case it was removed 
      (kinman)
      </fix>
      <fix>
      'xmlns' attributes that do not represent tag libraries are subject 
      to TLD check (luehe)
      </fix>
      <fix>
      Jasper *always* passes initial response character encoding 
      to ServletResponse (luehe)
      </fix>
      <fix>
      <bug>19713</bug>: Define "request" the out of line method when there is
      a &lt;jsp:param&gt; in the body of a custom tag (kinman)
      </fix>

    </changelog>

  </subsection>

  <subsection name="Webapps">

    <changelog>

      <update>
      Add placeholder code for a complete status display in the Status servlet,
      including webapps statistics (remm)
      </update>
      <fix>
      Fix WAR handling when deploying and undeploying webapps using the HTML
      manager (remm)
      </fix>
      <add>
      Add documentation on the default servlet (funkman)
      </add>
      <fix>
      Update information of the proxy documentation page (funkman)
      </fix>
      <update>
      Update the manager servlet to support versioning with the deploy method,
      in addition to other smaller refactorings (remm)
      </update>
      <add>
      Add changelog, status, and developers list (remm)
      </add>
      <update>
      Remove checkInterval attribute since it no longer exists (amyroh)
      </update>
      <fix>
      Use getSession(true) in the session example (remm)
      </fix>
      <update>
      Update documentation index, to reflect the docs structure (remm)
      </update>
      <fix>
      Disallow more than one SingleSignOn valve per service (amyroh)
      </fix>
      <fix>
      Unregister context and loader mbeans if it fails due to missing directory
      (amyroh)
      </fix>
      <fix>
      Fix to return an error page instead of error stack trace when a user 
      tries to create a context without creating a directory first (amyroh)
      </fix>
      <docs>
      Update manager documentation according to the new behavior (remm)
      </docs>
      <fix>
      Disable realm operations for engine until jaas realm is supported 
      in admin (amyroh)
      </fix>
      <docs>
      Use a book-like structure for the user related documentation (remm)
      </docs>
      <docs>
      Add new deployer documentation (remm)
      </docs>
      <docs>
      Fix MySQL JDBC connection example (glenn)
      </docs>
      <fix>
      Add proper MIME types for the content the JSPX examples generate, 
      submitted by Mark Roth (kinman)
      </fix>

    </changelog>

  </subsection>

  <subsection name="Deployer">

    <changelog>

      <scode>
      Deprecate install and remove tasks (remm)
      </scode>
      <update>
      Add new properties to the deploy task to allow for versioning and
      updating (remm)
      </update>
      <add>
      Generate minimal catalina-deployer JAR for use with the deployer (remm)
      </add>
      <add>
      New validator task, for use with the deployer (remm)
      </add>
      <update>
      Rename deploy.xml to build.xml for ease of use (remm)
      </update>

    </changelog>

  </subsection>

</section>

</body>
</document>
