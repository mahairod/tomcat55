<project name="Tomcat 5.0-nobin" default="all" basedir=".">

  <!-- 
       Build 5.0 from sources. No apache binary is used.
    -->

  <!-- See "build.properties.sample" in the top level directory for all     -->
  <!-- property values you must customize for successful building!!!        -->
  <property file="${user.home}/build.properties"/>
  <property file="build.properties"/>
  <property file="build.properties.default"/>
  
  <property name="basedir" location="." />
        
  <!-- Source dependencies -->
  <property name="api.home"
           value="${basedir}/../jakarta-servletapi-5"/>
  <property name="taglibs.home"
           value="${basedir}/../jakarta-taglibs"/>
  <property name="commons.home"
           value="${basedir}/../jakarta-commons"/>
  <property name="tomcat.home"
           value="${basedir}/../jakarta-tomcat"/>
  <property name="catalina.home"
           value="${basedir}/../jakarta-tomcat-catalina"/>
  <property name="jasper.home"
           value="${basedir}/../jakarta-tomcat-jasper-5/jasper2"/>
  <property name="jtc.home"
           value="${basedir}/../jakarta-tomcat-connectors"/>

  <property name="build.dir"   value="${basedir}/build/tomcat5"/>

  <property name="log4j.jar"   value="${base.path}/log4j/log4j.jar"/>


  <path id="alljars" >
    <pathelement location="${jmx.jar}"/>
    <pathelement location="${mail.jar}"/>
    <pathelement location="${regexp.jar}"/>
    <pathelement location="${jsse.jar}"/>
    <pathelement location="${jnet.jar}"/>
    <pathelement location="${jcert.jar}"/>
    <pathelement location="${activation.jar}"/>
    <pathelement location="${jta.jar}"/>
    <pathelement location="${log4j.jar}"/>
  </path>

  <path id="jasperjars" >
    <pathelement location="${jaxen.jar}"/>
    <pathelement location="${saxpath.jar}"/>
  </path>

  <!-- =================== DETECT: Display configuration ================== -->
  <target name="init"
          description="Display configuration and conditional compilation flags">
    <mkdir dir="${build.dir}/classes" />
    <echo message="Path: ${toString:alljars}"/>
  </target>


  <!-- ====================== COMBO: Clean All Directories ================ -->
  <target name="clean"
          description="Clean all components">
    <delete dir="${build.dir}"/>
  </target>

  <!-- ======================= COMBO: Build All Components ================ -->
  <target name="all"
          description="Clean, build, and deploy all components"
          depends="init,utils,tomcat,jasper" />

  <target name="utils"
          description="Utils build" >

    <javac destdir="${build.dir}/classes"
           optimize="off"
           debug="on"
           classpathref="alljars" >
      <src>
        <path location="${jtc.home}/util/java" />
        <path location="${commons.home}/modeler/src/java" />
        <path location="${commons.home}/digester/src/java" />
        <path location="${commons.home}/collections/src/java" />
        <path location="${commons.home}/beanutils/src/java" />
        <path location="${commons.home}/logging/src/java" />
      </src>
      <exclude name="org/apache/tomcat/util/net/PureTLS*" />
      <exclude name="org/apache/commons/logging/impl/LogKitLogger.java" />
      <exclude name="org/apache/commons/modeler/Modeler.java" />
    </javac>
  </target>

  <target name="tomcat"
          description="Tomcat build" >

    <javac destdir="${build.dir}/classes"
           optimize="off"
           debug="on"
           classpathref="alljars" >
      <src>
        <path location="${api.home}/src/share" />
        <path location="${catalina.home}/catalina/src/share" />
        <path location="${jtc.home}/coyote/src/java" />
        <path location="${jtc.home}/jk/java" />
        <path location="${jtc.home}/http11/src/java" />
        <path location="${tomcat.home}/src/share" />
      </src>
      <exclude name="org/apache/ajp/**" />
      <exclude name="org/apache/jasper/**" />
      <exclude name="org/apache/naming/factory/Tyrex*" />
      <exclude name="org/apache/tomcat/ant/Tomcat3Precompiler.java" />
      <exclude name="org/apache/catalina/startup/BootstrapService.java" />
    </javac>
  </target>


  <target name="jasper"
          description="Jasper build">
    <javac destdir="${build.dir}/classes"
           optimize="off"
           debug="on"
           classpathref="alljars" >
      <classpath refid="jasperjars"/>
      <src>
        <path location="${jasper.home}/src/share" />
        <path location="${taglibs.home}/standard/src" />
      </src>
      <exclude name="org/apache/taglibs/standard/tag/common/xml/**" />
      <exclude name="org/apache/taglibs/standard/lang/jstl/test/**" />
      <exclude name="org/apache/taglibs/standard/lang/jstl/parser/jsp20/ELParser.java" />
    </javac>
  </target>

  <target name="run" >
    <java classname="org.apache.catalina.startup.Bootstrap" >
      <classpath location="${build.dir}/classes"/>
    </java>
  </target>

  <target name="jdepend" description="Document the dependency graph ">
    <mkdir dir="${build.dir}/doc/jdepend" />
    <property name="jdepend.home" location="${base.path}/jdepend" />
    <property name="jdepend.jar" location="${jdepend.home}/lib/jdepend.jar" />

    <java classname="jdepend.xmlui.JDepend" >
      <classpath location="${jdepend.jar}"/>
      <arg line="-file ${build.dir}/doc/jdepend/jdepend.xml" />
      <arg value="${jtc.home}/util/java" />
      <arg value="${commons.home}/modeler/src/java" />
      <arg value="${commons.home}/digester/src/java" />
      <arg value="${commons.home}/collections/src/java" />
      <arg value="${commons.home}/beanutils/src/java" />
      <arg value="${commons.home}/logging/src/java" />
      <arg value="${api.home}/src/share" />
      <arg value="${catalina.home}/catalina/src/share" />
      <arg value="${jtc.home}/coyote/src/java" />
      <arg value="${jtc.home}/jk/java" />
      <arg value="${jtc.home}/http11/src/java" />
      <arg value="${tomcat.home}/src/share" />
      <arg value="${jasper.home}/src/share" />
      <arg value="${taglibs.home}/standard/src" />
    </java>

    <!-- Stylesheet stolen from krystalis -->
    <style basedir="${build.dir}/doc/jdepend" 
           destdir="${build.dir}/doc/jdepend"
           includes="jdepend.xml"
           style="${jdepend.home}/jdepend.xsl" />

  </target>


</project>
