<project name="tomcat-util" default="build-main" basedir=".">

    <!-- ===================== Initialize Property Values =================== -->
    <property file="build.properties"/>
    <property file="${user.home}/build.properties"/>

    <property name="tomcat-util.build" value="${basedir}/build"/>

    
    <target name="detect">
        <available property="jsse.present"
                   file="${jsse.lib}/jsse.jar"/>
        <!-- XXX make this file based, I don't like requiring it in the classpath -->
        <available property="puretls.present"
                   classname="COM.claymoresystems.ptls.SSLContext"/>
    </target>

    <target name="build-prepare" depends="detect">
        <mkdir dir="${tomcat-util.build}"/>
	<mkdir dir="${tomcat-util.build}/classes"/>
	<mkdir dir="${tomcat-util.build}/lib"/>
    </target>

    <target name="build-main" depends="build-prepare">
        <echo message="----- Java-utils -----" />
        <echo message="-- puretls.present = ${puretls.present}" />
        <echo message="-- jsse.present = ${jsse.present}"/>
        <javac srcdir="java"
	       destdir="${tomcat-util.build}/classes"
	       deprecation="on"
	       debug="on"
	       optimize="off"
	       verbose="off"
	       excludes="**/CVS/**">
            <classpath location="${jsse.lib}/jsse.jar" />
            <classpath location="${jsse.lib}/jnet.jar" />
            <classpath location="${jsse.lib}/jcert.jar" />
            <exclude name="**/util/net/JSSE*" unless="jsse.present"/>
            <exclude name="**/util/net/PureTLS*" unless="puretls.present"/>
	</javac>

	<!-- Copy static resource files -->
	<copy todir="${tomcat-util.build}/classes">
	    <fileset dir="java">
	    	<include name="**/*.properties"/>
	    </fileset>
        </copy>

	<!-- Copy static resource files -->
	<copy todir="${tomcat-util.build}/classes">
	    <fileset dir="java">
	    	<include name="**/*.properties"/>
	    </fileset>
        </copy>

	<jar jarfile="${tomcat-util.build}/lib/tomcat-util.jar"
	     basedir="${tomcat-util.build}/classes"
	     />
    </target>

    <!-- ================ BUILD: Create Tomcat-Util Javadocs =================== -->
    <target name="javadoc">
        <delete dir="${tomcat-util.build}/javadoc"/>
	<mkdir dir="${tomcat-util.build}/javadoc"/>
	<javadoc packagenames="org.apache.tomcat.util.*"
               sourcepath="java"
                  destdir="${tomcat-util.build}/javadoc"
                   author="true"
                  version="true"
              windowtitle="Tomcat Utilities Documentation"
                 doctitle="Tomcat Utilities"
                   bottom="Copyright &#169; 2001 Apache Software Foundation.  All Rights Reserved."
	/>
    </target>


    <target name="clean">
        <delete dir="${tomcat-util.build}"/>
    </target>
</project>
