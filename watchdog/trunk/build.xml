<project name="jakarta-check" default="core" basedir=".">

  <!-- system properties can be defined here, compiler can have the values:
       classic, modern, jikes -->
  <property name="build.compiler" value="classic"/>

  <target name="server">
     <mkdir dir="../build/tomcat/servlet-tests" />
     <mkdir dir="../build/tomcat/jsp-tests" />

    <copydir src="src/server/servlet-tests" dest="../build/tomcat/servlet-tests"/>
    <copydir src="src/server/jsp-tests" dest="../build/tomcat/jsp-tests"/>
     
    <javac srcdir="src/server/servlet-tests/WEB-INF/classes" destdir="../build/tomcat/servlet-tests/WEB-INF/classes" />
    <javac srcdir="src/server/jsp-tests/WEB-INF/classes" destdir="../build/tomcat/jsp-tests/WEB-INF/classes" />

  </target>

  <target name="client">
     <mkdir dir="../build/jakarta-check" />
     <mkdir dir="../build/jakarta-check/bin" />
     <mkdir dir="../build/jakarta-check/classes" />
     <mkdir dir="../build/jakarta-check/src" />

    <copydir src="src/shell" dest="../build/jakarta-check/bin"/>
    <copydir src="src/clients" dest="../build/jakarta-check/src"/>
     
    <javac srcdir="src/clients" destdir="../build/jakarta-check/classes" />    
  </target>


  <target name="core">

    <!-- create all the directories -->
    <mkdir dir="build/classes"/>
    <mkdir dir="build/jsp-tests"/>
    <mkdir dir="build/servlet-tests"/>
    <mkdir dir="build/props"/>

    <!-- copy the jars and web-applications -->
    <copydir src="src/server/jsp-tests" dest="build/jsp-tests"/>
    <copydir src="src/server/servlet-tests" dest="build/servlet-tests"/>
<!--
    <mkdir dir="build/servlet-tests/WEB-INF/lib"/>
    <mkdir dir="build/jsp-tests/WEB-INF/lib"/>
-->

    <!-- copy the scripts and properties -->
    <copyfile src="src/shell/runClient.ksh" dest="build/runClient"/>
    <copyfile src="src/shell/runClient.bat" dest="build/runClient.bat"/>
    <copyfile src="src/shell/runTest.ksh" dest="build/runTest"/>
    <copyfile src="src/shell/runTest.bat" dest="build/runTest.bat"/>
    <copyfile src="../jakarta-tools/moo.jar" dest="build/jsp-tests/WEB-INF/lib/moo.jar"/>
    <copyfile src="../jakarta-tools/moo.jar" dest="build/servlet-tests/WEB-INF/lib/moo.jar"/>
    <copyfile src="src/shell/jsp-testlist.txt" dest="build/jsp-testlist.txt"/>
    <copyfile src="src/shell/servlet-testlist.txt" dest="build/servlet-testlist.txt"/>
    <copyfile src="src/server/server.xml" dest="build/server.xml"/>
    <copyfile src="src/shell/jcheck.properties" dest="build/props/jcheck.properties"/>
    <copyfile src="src/shell/scheck.properties" dest="build/props/scheck.properties"/>
    <copyfile src="src/shell/jsp-tests.properties" dest="build/props/jsp-tests.properties"/>
    <copyfile src="src/shell/servlet-tests.properties" dest="build/props/servlet-tests.properties"/>

    <!-- compile the web-applications and the clients -->
    <javac srcdir="src/clients" destdir="build/classes" />
    <javac srcdir="src/server/servlet-tests/WEB-INF/classes" destdir="build/servlet-tests/WEB-INF/classes" />
    <javac srcdir="src/server/jsp-tests/WEB-INF/classes" destdir="build/jsp-tests/WEB-INF/classes" />

    <!-- create jars for the clients and the web-apps -->
    <jar jarfile="build/client.jar" basedir="build/classes" items="org"/>
    <jar jarfile="build/jsp-tests.war" basedir="build/jsp-tests" items="WEB-INF,jsp,golden-files"/>
    <jar jarfile="build/servlet-tests.war" basedir="build/servlet-tests" items="WEB-INF"/>

    <!-- delete the web-application directories -->
    <deltree dir="build/classes"/>
    <deltree dir="build/jsp-tests"/>
    <deltree dir="build/servlet-tests"/>
    
  </target>

  <target name="dist" depends="core">

    <!-- create dist directory -->
    <mkdir dir="dist"/>

    <!-- copy stuff from build -->
    <copydir src="build/props" dest="dist/props"/>
    <copyfile src="build/runTest" dest="dist/runTest"/>
    <copyfile src="build/runTest.bat" dest="dist/runTest.bat"/>
    <copyfile src="build/runClient" dest="dist/runClient"/>
    <copyfile src="build/runClient.bat" dest="dist/runClient.bat"/>
    <copyfile src="build/jsp-testlist.txt" dest="dist/jsp-testlist.txt"/>
    <copyfile src="build/servlet-testlist.txt" dest="dist/servlet-testlist.txt"/>
    <copyfile src="build/server.xml" dest="dist/server.xml"/>
    <copyfile src="build/client.jar" dest="dist/client.jar"/>
    <copyfile src="build/jsp-tests.war" dest="dist/jsp-tests.war"/>
    <copyfile src="build/servlet-tests.war" dest="dist/servlet-tests.war"/>
    
  </target>

  <target name="clean">
    <deltree dir="build"/>
    <deltree dir="dist"/>
  </target>

</project>
