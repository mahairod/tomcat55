================================================================================
  Licensed to the Apache Software Foundation (ASF) under one or more
  contributor license agreements.  See the NOTICE file distributed with
  this work for additional information regarding copyright ownership.
  The ASF licenses this file to You under the Apache License, Version 2.0
  (the "License"); you may not use this file except in compliance with
  the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
================================================================================

$Id$

                         =================================
                         Apache Tomcat 5.5 Patch Proposals
                         =================================


PATCHES PROPOSED TO BACKPORT:
  [ New proposals should be added at the end of the list ]

* Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51550
  Display error page rather than an empty response for an IllegalStateException
  https://issues.apache.org/bugzilla/attachment.cgi?id=27421
  +1: markt

      kkolinko: I do not like removing the catch from CoyoteAdapter. It
      looks safer the old way. JkCoyoteHandler does not handle Errors, just
      Exceptions. It seems from the patch that all you need to fix this bug is
        ep.setStatus(MsgContext.JK_STATUS_ERROR);
      Can't it be done by CoyoteAdapter itself?
        markt: In short, no. To correctly handle the error the associated
               processor needs to set the error flag and catching the exception
               in the CoyoteAdaptor prevents that. The processors catch
               Throwable so nothing extra will slip through.
               The JkCoyoteHandler is a special case since it is a completely
               different implementation. However, JkCoyoteHandler does need to
               be changed to catch Throwable rather than Exception. I have
               updated the proposed patch to do exactly that.
  -0: schultz: I tend to agree with Konstantin's assertion that the catch
      block is important. I understand the change to the status, but could
      you explain why the catch(Throwable) block has been removed?
        markt: See reply to kkolinko above.

  +1: kkolinko: OK with the updated patch.
       It seems though that
        1) MemoryProtocolHandler#process() should now try/catch(Throwable).
           The MemoryProtocolHandler is created in Embedded.java line 424.
       Maybe also
        2) i18n the message in JkCoyoteHandler.
        3) s/log.error()/log.info()/ in processors, because CoyoteAdapter
        used info() for its exception handling.
  -1:

* Detect incomplete AJP messages and reject the associated request if one is
  found
  http://people.apache.org/~markt/patches/2011-08-25-ajp-incomplete-msg-tc5.patch
  +1: markt
  +1: kkolinko: In AjpMessage#validatePos() s/"" + posToTest/String.valueOf(posToTest)/
        +1 to mark AjpMessage#getBytes(byte[]) as /**@deprecated*/ - it is never used.
  -1:

* Update Eclipse compiler and switch to using ecj.jar
  http://people.apache.org/~markt/patches/2011-08-25-lib-update-tc5-v2.patch
  +1: markt
  -1:

* Align jpda settings with catalina.sh, tc6.0.x, tc7.0.x and trunk
  http://people.apache.org/~markt/patches/2011-08-25-jpda-tc5.patch
  +1: markt, kkolinko
  -1:

* Update Tomcat-Native to 1.1.22
  s/tomcat-native.version=1.1.20/tomcat-native.version=1.1.22/
  in build/build.properties.default
  +1: kkolinko
  -1:
